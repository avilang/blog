<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />














<meta name="description" content="爱折腾，爱分享，爱学习">
<meta property="og:type" content="website">
<meta property="og:title" content="Hello avilang">
<meta property="og:url" content="https://avilang.github.io/blog/index.html">
<meta property="og:site_name" content="Hello avilang">
<meta property="og:description" content="爱折腾，爱分享，爱学习">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello avilang">
<meta name="twitter:description" content="爱折腾，爱分享，爱学习">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://avilang.github.io/blog/"/>

  <title> Hello avilang </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/blog/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hello avilang</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/javaScript 设计模式系列之四：组合模式/" itemprop="url">
                  javaScript 设计模式系列之四：组合模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-19T00:00:00+08:00" content="2017-10-19">
              2017-10-19
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>组合模式(Composite Pattern)：组合多个对象形成树形结构以表示具有“整体—部分”关系的层次结构。组合模式对单个对象（即叶子对象）和组合对象（即容器对象）的使用具有一致性，组合模式又可以称为“整体—部分”(Part-Whole)模式，它是一种对象结构型模式。</p>
<p><img src="/blog/myimages/2017-10-19_01.jpg" alt="" title="组合模式结构图"></p>
<p>在组合模式结构图中包含如下几个角色：</p>
<ul>
<li>Component（抽象构件）：它可以是接口或抽象类，为叶子构件和容器构件对象声明接口，在该角色中可以包含所有子类共有行为的声明和实现。在抽象构件中定义了访问及管理它的子构件的方法，如增加子构件、删除子构件、获取子构件等。</li>
<li>Leaf（叶子构件）：它在组合结构中表示叶子节点对象，叶子节点没有子节点，它实现了在抽象构件中定义的行为。对于那些访问及管理子构件的方法，可以通过异常等方式进行处理。</li>
<li>Composite（容器构件）：它在组合结构中表示容器节点对象，容器节点包含子节点，其子节点可以是叶子节点，也可以是容器节点，它提供一个集合用于存储子节点，实现了在抽象构件中定义的行为，包括那些访问及管理子构件的方法，在其业务方法中可以递归调用其子节点的业务方法。</li>
</ul>
<h3 id="例子：餐厅菜单的应用"><a href="#例子：餐厅菜单的应用" class="headerlink" title="例子：餐厅菜单的应用"></a>例子：餐厅菜单的应用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "抽象构件"</span></span><br><span class="line"><span class="keyword">var</span> MenuComponent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.getDescription = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.getPrice = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.isVegetarian = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.print = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">MenuComponent.prototype.getChild = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "叶子构件"</span></span><br><span class="line"><span class="keyword">var</span> MenuItem = <span class="function"><span class="keyword">function</span>(<span class="params">sName, sDescription, bVegetarian, nPrice</span>)</span>&#123;</span><br><span class="line">  MenuComponent.apply(<span class="keyword">this</span>);		</span><br><span class="line">  <span class="keyword">this</span>.sName = sName;</span><br><span class="line">  <span class="keyword">this</span>.sDescription = sDescription;</span><br><span class="line">  <span class="keyword">this</span>.bVegetarian = bVegetarian;</span><br><span class="line">  <span class="keyword">this</span>.nPrice = nPrice;</span><br><span class="line">&#125;;</span><br><span class="line">MenuItem.prototype = <span class="keyword">new</span> MenuComponent();</span><br><span class="line">MenuItem.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sName;</span><br><span class="line">&#125;;</span><br><span class="line">MenuItem.prototype.getDescription = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sDescription;</span><br><span class="line">&#125;;</span><br><span class="line">MenuItem.prototype.getPrice = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.nPrice;</span><br><span class="line">&#125;;</span><br><span class="line">MenuItem.prototype.isVegetarian = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.bVegetarian;</span><br><span class="line">&#125;;</span><br><span class="line">MenuItem.prototype.print = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.getName() + <span class="string">": "</span> + <span class="keyword">this</span>.getDescription() + <span class="string">", "</span> + <span class="keyword">this</span>.getPrice() + <span class="string">"euros"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "容器构件"</span></span><br><span class="line"><span class="keyword">var</span> Menu = <span class="function"><span class="keyword">function</span>(<span class="params">sName, sDescription</span>)</span>&#123;</span><br><span class="line">  MenuComponent.apply(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">this</span>.aMenuComponents = [];</span><br><span class="line">  <span class="keyword">this</span>.sName = sName;</span><br><span class="line">  <span class="keyword">this</span>.sDescription = sDescription;</span><br><span class="line">  <span class="keyword">this</span>.createIterator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This method must be overwritten!"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype = <span class="keyword">new</span> MenuComponent();</span><br><span class="line">Menu.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">oMenuComponent</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.aMenuComponents.push(oMenuComponent);</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">oMenuComponent</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> aMenuItems = [];</span><br><span class="line">  <span class="keyword">var</span> nMenuItem = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> nLenMenuItems = <span class="keyword">this</span>.aMenuComponents.length;</span><br><span class="line">  <span class="keyword">var</span> oItem = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(; nMenuItem &lt; nLenMenuItems;)&#123;</span><br><span class="line">    oItem = <span class="keyword">this</span>.aMenuComponents[nMenuItem];</span><br><span class="line">    <span class="keyword">if</span>(oItem !== oMenuComponent)&#123;</span><br><span class="line">      aMenuItems.push(oItem);</span><br><span class="line">    &#125;</span><br><span class="line">    nMenuItem = nMenuItem + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.aMenuComponents = aMenuItems;</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype.getChild = <span class="function"><span class="keyword">function</span>(<span class="params">nIndex</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.aMenuComponents[nIndex];</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sName;</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype.getDescription = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sDescription;</span><br><span class="line">&#125;;</span><br><span class="line">Menu.prototype.print = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.getName() + <span class="string">": "</span> + <span class="keyword">this</span>.getDescription());</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"--------------------------------------------"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> nMenuComponent = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> nLenMenuComponents = <span class="keyword">this</span>.aMenuComponents.length;</span><br><span class="line">  <span class="keyword">var</span> oMenuComponent = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(; nMenuComponent &lt; nLenMenuComponents;)&#123;</span><br><span class="line">    oMenuComponent = <span class="keyword">this</span>.aMenuComponents[nMenuComponent];</span><br><span class="line">    oMenuComponent.print();</span><br><span class="line">    nMenuComponent = nMenuComponent + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "指定具体容器"</span></span><br><span class="line"><span class="keyword">var</span> DinnerMenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  Menu.apply(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">DinnerMenu.prototype = <span class="keyword">new</span> Menu();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CafeMenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  Menu.apply(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">CafeMenu.prototype = <span class="keyword">new</span> Menu();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> PancakeHouseMenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  Menu.apply(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">PancakeHouseMenu.prototype = <span class="keyword">new</span> Menu();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "顶级容器"</span></span><br><span class="line"><span class="keyword">var</span> Mattress = <span class="function"><span class="keyword">function</span>(<span class="params">aMenus</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.aMenus = aMenus;</span><br><span class="line">&#125;;</span><br><span class="line">Mattress.prototype.printMenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.aMenus.print();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">var</span> oPanCakeHouseMenu = <span class="keyword">new</span> Menu(<span class="string">"Pancake House Menu"</span>, <span class="string">"Breakfast"</span>);</span><br><span class="line"><span class="keyword">var</span> oDinnerMenu = <span class="keyword">new</span> Menu(<span class="string">"Dinner Menu"</span>, <span class="string">"Lunch"</span>);</span><br><span class="line"><span class="keyword">var</span> oCoffeeMenu = <span class="keyword">new</span> Menu(<span class="string">"Cafe Menu"</span>, <span class="string">"Dinner"</span>);</span><br><span class="line"><span class="keyword">var</span> oAllMenus = <span class="keyword">new</span> Menu(<span class="string">"ALL MENUS"</span>, <span class="string">"All menus combined"</span>);</span><br><span class="line">oAllMenus.add(oPanCakeHouseMenu);</span><br><span class="line">oAllMenus.add(oDinnerMenu);</span><br><span class="line">oDinnerMenu.add(<span class="keyword">new</span> MenuItem(<span class="string">"Pasta"</span>, <span class="string">"Spaghetti with Marinara Sauce, and a slice of sourdough bread"</span>, <span class="literal">true</span>, <span class="number">3.89</span>));</span><br><span class="line">oDinnerMenu.add(oCoffeeMenu);</span><br><span class="line">oCoffeeMenu.add(<span class="keyword">new</span> MenuItem(<span class="string">"Express"</span>, <span class="string">"Coffee from machine"</span>, <span class="literal">false</span>, <span class="number">0.99</span>));</span><br><span class="line"><span class="keyword">var</span> oMattress = <span class="keyword">new</span> Mattress(oAllMenus);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"---------------------------------------------"</span>);</span><br><span class="line">oMattress.printMenu();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"---------------------------------------------"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><p><a href="https://github.com/tcorral/Design-Patterns-in-Javascript/tree/master/Composite" target="_blank" rel="noopener">Design-Patterns-in-Javascript-Composite</a><br><a href="http://wiki.jikexueyuan.com/project/design-pattern-structurized/composite-one.html" target="_blank" rel="noopener">树形结构的处理——组合模式</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/javaScript 设计模式系列之三：代理模式/" itemprop="url">
                  javaScript 设计模式系列之三：代理模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-01T00:00:00+08:00" content="2017-09-01">
              2017-09-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">代理模式</a>为其他对象提供一种代理以控制对这个对象的访问。</p>
<p><img src="/blog/myimages/2017-09-01_01.png" alt="" title="代理模式的统一建模语言(UML)图"></p>
<p>根据代理模式的使用目的不同，代理模式又可以分为多种类型</p>
<ul>
<li>远程代理 (Remote Proxy)</li>
<li>虚拟代理 (Virtual Proxy) 如需要创建一个资源消耗较大的对象，先创建一个消耗相对较小的对象来表示，真实对象只在需要时才会被真正创建。</li>
<li>保护代理 (Protect Proxy) 用来控制真实对象访问的权限。</li>
<li>缓冲代理 (Cache Proxy) 为某一个目标操作的结果提供临时的存储空间，以便多个客户端可以共享这些结果。</li>
<li>智能引用代理（Smart Reference Proxy）当一个对象被引用时，提供一些额外的操作，例如将对象被调用的次数记录下来等。</li>
</ul>
<h3 id="虚拟代理示例"><a href="#虚拟代理示例" class="headerlink" title="虚拟代理示例"></a>虚拟代理示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DynamicProxy abstract class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DynamicProxy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.args = <span class="built_in">arguments</span>;</span><br><span class="line">  <span class="keyword">this</span>.initialized = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">this</span>.class != <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'DynamicProxy: the class attribute must be set before calling the super-class constructor.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the methods needed to implement the same interface.</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.class.prototype) &#123;</span><br><span class="line">    <span class="comment">// Ensure that the property is a function</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">this</span>.class.prototype[key] !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the method.</span></span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">methodName</span>) </span>&#123;</span><br><span class="line">      that[methodName] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!that.initialized) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> that.subject[methodName].apply(that.subject, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">DynamicProxy.prototype = &#123;</span><br><span class="line">  <span class="keyword">constructor</span>: DynamicProxy,</span><br><span class="line">  _initialize: function() &#123;</span><br><span class="line">    <span class="keyword">this</span>.subject = &#123;&#125;; <span class="comment">// Instantiate the class.</span></span><br><span class="line">    <span class="keyword">this</span>.class.apply(<span class="keyword">this</span>.subject, <span class="keyword">this</span>.args);</span><br><span class="line">    <span class="keyword">this</span>.subject.__proto__ = <span class="keyword">this</span>.class.prototype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.initialized = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">DynamicProxy.extend = <span class="function"><span class="keyword">function</span>(<span class="params">subclass, superclass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> superclass.prototype) &#123;</span><br><span class="line">    <span class="keyword">if</span>(key !== <span class="string">'constructor'</span>)</span><br><span class="line">      subclass.prototype[key] = superclass.prototype[key];</span><br><span class="line">  &#125;</span><br><span class="line">  subclass.superclass = superclass;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TestProxy class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestProxy</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.class = TestClass;</span><br><span class="line">  TestProxy.superclass.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br><span class="line">DynamicProxy.extend(TestProxy, DynamicProxy);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Test class.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; name </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestClass</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name || <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestClass.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line">TestClass.prototype.setName = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> TestProxy(<span class="string">'Tom'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(test.getName()); <span class="comment">// undefined</span></span><br><span class="line">test._initialize();</span><br><span class="line"><span class="built_in">console</span>.log(test.getName()); <span class="comment">// Tom</span></span><br><span class="line">test.setName(<span class="string">'Mary'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(test.getName()); <span class="comment">// Mary</span></span><br></pre></td></tr></table></figure>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><p><a href="http://blog.csdn.net/lovelion/article/details/17517213" target="_blank" rel="noopener">史上最全设计模式导学目录（完整版）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/javaScript 设计模式系列之二：适配器模式/" itemprop="url">
                  javaScript 设计模式系列之二：适配器模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-08T00:00:00+08:00" content="2017-06-08">
              2017-06-08
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><a href="https://zh.wikipedia.org/wiki/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">适配器模式</a>将一个类的接口转接成用户所期待的，有助于避免大规模改写现有客户代码。</p>
<blockquote>
<p>In software engineering, the adapter pattern is a software design pattern that allows the interface of an existing class to be used from another interface. It is often used to make existing classes work with others without modifying their source code. </p>
</blockquote>
<p>例：电源转换器，我们国家的电器使用普通的扁平两项或三项插头，而去外国的话，使用的标准就不一样了，比如德国，使用的是德国标准，是两项圆头的插头。如果去德国旅游，那么我们使用的手机充电器插头无法插到德国的插排中去，那就意味着我们无法给手机充电。怎样解决这个问题呢？只要使用一个电源转化器就行了。</p>
<h3 id="例子：购物车"><a href="#例子：购物车" class="headerlink" title="例子：购物车"></a>例子：购物车</h3><h4 id="Shopping-Cart-Example-with-Local-Storage"><a href="#Shopping-Cart-Example-with-Local-Storage" class="headerlink" title="Shopping Cart Example with Local Storage"></a>Shopping Cart Example with Local Storage</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShoppingCart</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">ShoppingCart.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> items = localStorage.getItem(<span class="string">'cart'</span>);</span><br><span class="line">  <span class="keyword">if</span> (items) &#123;</span><br><span class="line">    items = <span class="built_in">JSON</span>.parse(items);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (items[item.id]) &#123;</span><br><span class="line">      items[item.id].quantity += <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      item.quantity = <span class="number">1</span>;</span><br><span class="line">      items[item.id] = item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    items = &#123;&#125;;</span><br><span class="line">    item.quantity = <span class="number">1</span>;</span><br><span class="line">    items[item.id] = item;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  items = <span class="built_in">JSON</span>.stringify(items);</span><br><span class="line">  localStorage.setItem(<span class="string">'cart'</span>, items);</span><br><span class="line">  <span class="keyword">return</span> item;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cart = <span class="keyword">new</span> ShoppingCart();</span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">product</span>: <span class="string">'movie 1'</span> &#125;); <span class="comment">// quantity is 1 for product 1</span></span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">product</span>: <span class="string">'movie 2'</span> &#125;); <span class="comment">// quantity is 1 for product 2</span></span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">product</span>: <span class="string">'movie 1'</span> &#125;); <span class="comment">// quantity is 2 for product 1</span></span><br></pre></td></tr></table></figure>
<p>上面代码中通过 localStorage 存储购物车的数据。若此时改变需求，需要通过服务器端存储，这时你不得不改变现有的代码，此时更好的实现方式时引入”适配器”。</p>
<h4 id="Shopping-Cart-Example-with-Adapters"><a href="#Shopping-Cart-Example-with-Adapters" class="headerlink" title="Shopping Cart Example with Adapters"></a>Shopping Cart Example with Adapters</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  jQuery deferreds and promises</span></span><br><span class="line"><span class="keyword">var</span> localStorageAdapter = &#123;</span><br><span class="line">  findAll: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = <span class="keyword">new</span> $.Deferred();</span><br><span class="line">    <span class="keyword">var</span> items = localStorage.getItem(<span class="string">'cart'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (items) &#123;</span><br><span class="line">      items = <span class="built_in">JSON</span>.parse(items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deferred.resolve(items);</span><br><span class="line">    <span class="keyword">return</span> deferred.promise();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  save: <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = <span class="keyword">new</span> $.Deferred();</span><br><span class="line"></span><br><span class="line">    items = <span class="built_in">JSON</span>.stringify(items);</span><br><span class="line">    localStorage.setItem(<span class="string">'cart'</span>, items);</span><br><span class="line">    deferred.resolve();</span><br><span class="line">    <span class="keyword">return</span> deferred.promise();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  jQuery deferreds and promises.</span></span><br><span class="line"><span class="keyword">var</span> serverSideAdapter = &#123;</span><br><span class="line">  findAll: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">      url: <span class="string">'/shopping-cart'</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> response.items;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  save: <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">      url: <span class="string">'/shopping-cart'</span>,</span><br><span class="line">      type: <span class="string">'post'</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        items: items</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShoppingCart</span>(<span class="params">adapter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.adapter = adapter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ShoppingCart.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> adapter = <span class="keyword">this</span>.adapter;</span><br><span class="line">  <span class="keyword">var</span> deferred = <span class="keyword">new</span> $.Deferred();</span><br><span class="line"></span><br><span class="line">  adapter.findAll().then(<span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (items) &#123;</span><br><span class="line">      <span class="keyword">if</span> (items[item.id]) &#123;</span><br><span class="line">        items[item.id].quantity += <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        item.quantity = <span class="number">1</span>;</span><br><span class="line">        items[item.id] = item;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      items = &#123;&#125;;</span><br><span class="line">      item.quantity = <span class="number">1</span>;</span><br><span class="line">      items[item.id] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    adapter.save(items).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      deferred.resolve(item);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> deferred.promise();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// localStorageAdapter</span></span><br><span class="line"><span class="keyword">var</span> cart = <span class="keyword">new</span> ShoppingCart(localStorageAdapter);</span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">product</span>: <span class="string">'movie 1'</span> &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123; &#125;); <span class="comment">// quantity is 1 for product 1</span></span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">product</span>: <span class="string">'movie 2'</span> &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123; &#125;); <span class="comment">// quantity is 1 for product 2</span></span><br><span class="line">cart.add(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">product</span>: <span class="string">'movie 1'</span> &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123; &#125;); <span class="comment">// quantity is 2 for product 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// serverSideAdapter</span></span><br><span class="line"><span class="keyword">var</span> cart = <span class="keyword">new</span> ShoppingCart(serverSideAdapter);</span><br></pre></td></tr></table></figure>
<h3 id="例子：日志记录"><a href="#例子：日志记录" class="headerlink" title="例子：日志记录"></a>例子：日志记录</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前 logger </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BadLogger</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">var</span> LOG_HEADER = <span class="string">'['</span> + name + <span class="string">']:'</span>;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getName: <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.name;</span><br><span class="line">        &#125;,</span><br><span class="line">        getType: <span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'BadLogger'</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        information: <span class="function"><span class="keyword">function</span> <span class="title">information</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.info(LOG_HEADER + message + <span class="string">'- INFORMATION'</span> );</span><br><span class="line">        &#125;,</span><br><span class="line">        debg: <span class="function"><span class="keyword">function</span> <span class="title">debg</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(LOG_HEADER + message + <span class="string">'- DEBG'</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        w: <span class="function"><span class="keyword">function</span> <span class="title">w</span>(<span class="params">message</span>) </span>&#123; <span class="comment">// w stands for warning.</span></span><br><span class="line">            <span class="built_in">console</span>.warn(LOG_HEADER + message + <span class="string">'- W'</span> );</span><br><span class="line">        &#125;,</span><br><span class="line">        err: <span class="function"><span class="keyword">function</span> <span class="title">err</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(LOG_HEADER + message+ <span class="string">'- ERR'</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;  </span><br><span class="line">    getLogger: BadLogger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 另一个 logger</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ShortLogger</span>(<span class="params">name</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">var</span> LOG_HEADER = <span class="string">'['</span> + name + <span class="string">']'</span>;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> getTime = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'['</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().toISOString() + <span class="string">']'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getName: <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.name;</span><br><span class="line">        &#125;,</span><br><span class="line">        getType: <span class="function"><span class="keyword">function</span> <span class="title">getType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'ShortLogger'</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        i: <span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.info(LOG_HEADER + getTime() + <span class="string">'[I]: '</span> + message);</span><br><span class="line">        &#125;,</span><br><span class="line">        d: <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(LOG_HEADER + getTime() + <span class="string">'[D]: '</span> + message);</span><br><span class="line">        &#125;,</span><br><span class="line">        w: <span class="function"><span class="keyword">function</span> <span class="title">w</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.warn(LOG_HEADER + getTime() + <span class="string">'[W]: '</span> + message);</span><br><span class="line">        &#125;,</span><br><span class="line">        e: <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(LOG_HEADER + getTime() + <span class="string">'[E]: '</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;  </span><br><span class="line">    getLogger: ShortLogger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ShortLogger = <span class="built_in">require</span>(<span class="string">'./ShortLogger'</span>);  </span><br><span class="line"><span class="keyword">var</span> BadLogger = <span class="built_in">require</span>(<span class="string">'./BadLogger'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoggerAdapter</span>(<span class="params">loggerObj</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (!loggerObj) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'Parameter [loggerObj] is not defined.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'[LoggerAdapter] is using Logger with name: '</span> + loggerObj.getName());</span><br><span class="line">    <span class="keyword">var</span> CONSTANTS = &#123;</span><br><span class="line">        DEBUG: <span class="string">'DEBUG'</span>,</span><br><span class="line">        WARNING: <span class="string">'WARNING'</span>,</span><br><span class="line">        INFORMATION: <span class="string">'INFORMATION'</span>,</span><br><span class="line">        ERROR: <span class="string">'ERROR'</span>,</span><br><span class="line">        BAD_LOGGER: <span class="string">'BadLogger'</span>,</span><br><span class="line">        SHORT_LOGGER: <span class="string">'ShortLogger'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> loggerFunctionMapper = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(loggerObj.getType() === CONSTANTS.BAD_LOGGER) &#123;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.DEBUG] = loggerObj.debg;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.INFORMATION] = loggerObj.information;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.WARNING] = loggerObj.w;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.ERROR] = loggerObj.err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (loggerObj.getType() === CONSTANTS.SHORT_LOGGER) &#123;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.DEBUG] = loggerObj.d;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.INFORMATION] = loggerObj.i;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.WARNING] = loggerObj.w;</span><br><span class="line">        loggerFunctionMapper[CONSTANTS.ERROR] = loggerObj.e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">information</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          loggerFunctionMapper[CONSTANTS.INFORMATION](message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'No implementation for Logger: '</span> + loggerObj.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">debug</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          loggerFunctionMapper[CONSTANTS.DEBUG](message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'No implementation for Logger: '</span> + loggerObj.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        debug: debug,</span><br><span class="line">        information: information,</span><br><span class="line">        warning: warning,</span><br><span class="line">        error: error</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;  </span><br><span class="line">    LoggerAdapter: LoggerAdapter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ShortLogger = <span class="built_in">require</span>(<span class="string">'./ShortLogger'</span>);  </span><br><span class="line"><span class="keyword">var</span> BadLogger = <span class="built_in">require</span>(<span class="string">'./BadLogger'</span>);  </span><br><span class="line"><span class="keyword">var</span> LoggerAdapter = <span class="built_in">require</span>(<span class="string">'./LoggerAdapter'</span>);  </span><br><span class="line"><span class="keyword">var</span> shortLog = ShortLogger.getLogger(<span class="string">'ShortLoger'</span>);  </span><br><span class="line"><span class="keyword">var</span> badLogger = BadLogger.getLogger(<span class="string">'BadLogger'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loggerAdapter = LoggerAdapter.LoggerAdapter(badLogger);  </span><br><span class="line">loggerAdapter.information(<span class="string">'This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter.debug(<span class="string">'This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter.warning(<span class="string">'This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter.error(<span class="string">'This is logged through LoggerAdapter'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loggerAdapter2 = LoggerAdapter.LoggerAdapter(shortLog);  </span><br><span class="line">loggerAdapter2.information(<span class="string">'Now This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter2.debug(<span class="string">'Now This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter2.warning(<span class="string">'Now This is logged through LoggerAdapter'</span>);  </span><br><span class="line">loggerAdapter2.error(<span class="string">'Now This is logged through LoggerAdapter'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><p><a href="http://thejsguy.com/2015/10/16/the-adapter-pattern-in-javascript.html" target="_blank" rel="noopener">The Adapter Pattern in JavaScript</a><br><a href="http://dealwithjs.io/design-patterns-the-adapter-pattern-in-javascript/" target="_blank" rel="noopener">Design Patterns - The Adapter Pattern in JavaScript</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/javaScript 设计模式系列之一：观察者模式/" itemprop="url">
                  javaScript 设计模式系列之一：观察者模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-20T00:00:00+08:00" content="2017-05-20">
              2017-05-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><a href="https://zh.wikipedia.org/wiki/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">观察者模式</a>又叫发布订阅模式(Publish/Subscribe)，一个目标对象管理所有相依于它的观察者对象。该模式中存在两个角色：观察者和被观察者。目标对象与观察者之间的抽象耦合关系能够单独扩展以及重用。</p>
<p>该模式通常有两种实现策略：”推”(push) 和 “拉”(pull)</p>
<blockquote>
<p>例：对于报社可能雇佣投送人员四处送报给订阅者，这就是主动推送。而对于规模小的报社没有足够的资源去雇佣投送员，这时候可以采取 “拉” 的方式。就是在订阅者附近提供自己的数据，供订阅者 “拉” 自己所需的数据。</p>
</blockquote>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="push"><a href="#push" class="headerlink" title="push"></a>push</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Observable = &#123;</span><br><span class="line">    observers: []</span><br><span class="line">  , <span class="attr">lastId</span>: <span class="number">-1</span></span><br><span class="line">  , <span class="attr">addObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.observers.push(&#123;</span><br><span class="line">        callback: observer</span><br><span class="line">      , <span class="attr">id</span>: ++<span class="keyword">this</span>.lastId</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.lastId</span><br><span class="line">    &#125;</span><br><span class="line">  , <span class="attr">removeObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.observers.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers[i]</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.observers[i].id == id) &#123;</span><br><span class="line">          <span class="keyword">this</span>.observers.splice(i, <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  , <span class="attr">notifyObservers</span>: <span class="function"><span class="keyword">function</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.observers.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers[i].callback(message)</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id_1 = Observable.addObserver(<span class="function"><span class="keyword">function</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"First observer message:"</span> + message)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observer = <span class="function"><span class="keyword">function</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Second observer message:"</span> + message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> id_2 = Observable.addObserver(observer)</span><br><span class="line"></span><br><span class="line">Observable.notifyObservers(<span class="string">'test 1'</span>)</span><br><span class="line">Observable.removeObserver(id_2)</span><br><span class="line">Observable.notifyObservers(<span class="string">'test 2'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Observable = &#123;&#125;</span><br><span class="line"></span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">O</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> observers = []</span><br><span class="line">    , privateVar</span><br><span class="line"></span><br><span class="line">  O.addObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    observers.push(observer)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  O.removeObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = observers.indexOf(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (~index) &#123;</span><br><span class="line">      observers.splice(index, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  O.notifyObservers = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = observers.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      observers[i].update()</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  O.updatePrivate = <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    privateVar = newValue</span><br><span class="line">    <span class="keyword">this</span>.notifyObservers()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  O.getPrivate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> privateVar</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(Observable))</span><br><span class="line"></span><br><span class="line">Observable.addObserver(&#123;</span><br><span class="line">  update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.process()</span><br><span class="line">  &#125;</span><br><span class="line">, <span class="attr">process</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = Observable.getPrivate()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Private value is: "</span> + value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Observable.updatePrivate(<span class="string">'test 1'</span>)</span><br><span class="line"><span class="comment">// Private value is: test 1</span></span><br><span class="line"></span><br><span class="line">Observable.updatePrivate(<span class="string">'test 2'</span>)</span><br><span class="line"><span class="comment">// Private value is: test 2</span></span><br></pre></td></tr></table></figure>
<p>被观察对象将通知所有的观察者，并且每个观察者将从被观察对象中提取所需的信息。</p>
<h4 id="让多个对象都具有观察者发布订阅的功能"><a href="#让多个对象都具有观察者发布订阅的功能" class="headerlink" title="让多个对象都具有观察者发布订阅的功能"></a>让多个对象都具有观察者发布订阅的功能</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = &#123;</span><br><span class="line">    addSubscriber:<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subscribers[<span class="keyword">this</span>.subscribers.length] = callback;</span><br><span class="line">    &#125;,</span><br><span class="line">    removeSubscriber:<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.subscribers.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.subscribers[i] === callback) &#123;</span><br><span class="line">                <span class="keyword">delete</span>(<span class="keyword">this</span>.subscribers[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    publish:<span class="function"><span class="keyword">function</span> (<span class="params">what</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.subscribers.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.subscribers[i] === <span class="string">'function'</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.subscribers[i](what);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    make:<span class="function"><span class="keyword">function</span> (<span class="params">o</span>) </span>&#123; <span class="comment">// turns an object into a publisher</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">            o[i] = <span class="keyword">this</span>[i];</span><br><span class="line">            o.subscribers = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blogger = &#123;</span><br><span class="line">    writeBlogPost:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> content = <span class="string">'Today is '</span> + <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">this</span>.publish(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> la_times = &#123;</span><br><span class="line">    newIssue:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> paper = <span class="string">'Martians have landed on Earth!'</span>;</span><br><span class="line">        <span class="keyword">this</span>.publish(paper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">observer.make(blogger);</span><br><span class="line">observer.make(la_times);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jack = &#123;</span><br><span class="line">    read:<span class="function"><span class="keyword">function</span> (<span class="params">what</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'I just read that '</span> + what)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> jill = &#123;</span><br><span class="line">    gossip:<span class="function"><span class="keyword">function</span> (<span class="params">what</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'You didn\'t hear it from me, but '</span> + what)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">blogger.addSubscriber(jack.read);</span><br><span class="line">blogger.addSubscriber(jill.gossip);</span><br><span class="line">blogger.writeBlogPost();</span><br><span class="line">blogger.removeSubscriber(jill.gossip);</span><br><span class="line">blogger.writeBlogPost();</span><br><span class="line">la_times.addSubscriber(jill.gossip);</span><br><span class="line">la_times.newIssue();</span><br></pre></td></tr></table></figure>
<h4 id="避免创建多个被观察者对象，可以增加-“命名空间”"><a href="#避免创建多个被观察者对象，可以增加-“命名空间”" class="headerlink" title="避免创建多个被观察者对象，可以增加 “命名空间”"></a>避免创建多个被观察者对象，可以增加 “命名空间”</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Observable = &#123;</span><br><span class="line">    observers: []</span><br><span class="line">  , <span class="attr">addObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">topic, observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.observers[topic] || (<span class="keyword">this</span>.observers[topic] = [])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.observers[topic].push(observer)</span><br><span class="line">    &#125;</span><br><span class="line">  , <span class="attr">removeObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">topic, observer</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.observers[topic])</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> index = <span class="keyword">this</span>.observers[topic].indexOf(observer)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (~index) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers[topic].splice(index, <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  , <span class="attr">notifyObservers</span>: <span class="function"><span class="keyword">function</span>(<span class="params">topic, message</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.observers[topic])</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.observers[topic].length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">this</span>.observers[topic][i](message)</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observable.addObserver(<span class="string">'cart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"First observer message:"</span> + message)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Observable.addObserver(<span class="string">'notificatons'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Second observer message:"</span> + message)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Observable.notifyObservers(<span class="string">'cart'</span>, <span class="string">'test 1'</span>)</span><br><span class="line"><span class="comment">// First observer message:test 1</span></span><br><span class="line"></span><br><span class="line">Observable.notifyObservers(<span class="string">'notificatons'</span>, <span class="string">'test 2'</span>)</span><br><span class="line"><span class="comment">// Second observer message:test 2</span></span><br></pre></td></tr></table></figure>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><p><a href="https://bumbu.github.io/javascript-observer-publish-subscribe-pattern/" target="_blank" rel="noopener">javascript-observer-publish-subscribe-pattern</a><br><a href="http://www.cnblogs.com/TomXu/archive/2012/03/02/2355128.html" target="_blank" rel="noopener">深入理解JavaScript系列（32）：设计模式之观察者模式</a><br><a href="https://github.com/shichuan/javascript-patterns/blob/master/design-patterns/observer.html" target="_blank" rel="noopener">javascript-patterns-observer</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/聊聊 S.O.L.I.D 五大原则/" itemprop="url">
                  聊聊 S.O.L.I.D 五大原则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-04-22T00:00:00+08:00" content="2017-04-22">
              2017-04-22
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>今天聊聊在面向对象编程中的五个基本原则，适当的利用这些原则，让代码变得可维护和扩展。本文以 javascript 语言为例，可能以这门语言来讨论 S.O.L.I.D 五大原则有点不伦不类，但其中的思想是很必要去学习和理解的。</p>
<h3 id="单一职责-Single-Responsibility-Principle"><a href="#单一职责-Single-Responsibility-Principle" class="headerlink" title="单一职责(Single Responsibility Principle)"></a>单一职责(Single Responsibility Principle)</h3><p><a href="https://zh.wikipedia.org/wiki/%E5%8D%95%E4%B8%80%E5%8A%9F%E8%83%BD%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">单一职责</a>的描述如下：</p>
<blockquote>
<p>A class should have only one reason to change<br>类发生更改的原因应该只有一个</p>
</blockquote>
<p>遵守单一职责的好处是可以让我们很容易地来维护这个对象，当一个对象封装了很多职责的话，一旦一个职责需要修改，势必会影响该对象想的其它职责代码。通过解耦可以让每个职责工更加有弹性地变化。</p>
<p>相关阅读：<a href="http://www.cnblogs.com/TomXu/archive/2012/01/06/2305513.html" target="_blank" rel="noopener">深入理解JavaScript系列（6）：S.O.L.I.D五大原则之单一职责SRP</a></p>
<h3 id="开闭原则-Open-Closed-Principle"><a href="#开闭原则-Open-Closed-Principle" class="headerlink" title="开闭原则(Open/Closed Principle)"></a>开闭原则(Open/Closed Principle)</h3><p><a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">开闭原则</a>的描述如下：</p>
<blockquote>
<p>Software entities (classes, modules, functions, etc.) should be open for extension but closed for modification.<br>软件实体（类，模块，方法等等）应当对扩展开放，对修改关闭，即软件实体应当在不修改的前提下扩展。</p>
</blockquote>
<p>为了直观地描述，下面给出一个动态展示问题列表的代码作为演示（不符合开闭原则）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题类型</span></span><br><span class="line"><span class="keyword">var</span> AnswerType = &#123;</span><br><span class="line">    Choice: <span class="number">0</span>,</span><br><span class="line">    Input: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题实体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">question</span>(<span class="params">label, answerType, choices</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        label: label,</span><br><span class="line">        answerType: answerType,</span><br><span class="line">        choices: choices <span class="comment">// 是可选参数</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> view = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// render</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">renderQuestion</span>(<span class="params">target, question</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> questionWrapper = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        questionWrapper.className = <span class="string">'question'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> questionLabel = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        questionLabel.className = <span class="string">'question-label'</span>;</span><br><span class="line">        <span class="keyword">var</span> label = <span class="built_in">document</span>.createTextNode(question.label);</span><br><span class="line">        questionLabel.appendChild(label);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> answer = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        answer.className = <span class="string">'question-input'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据不同的类型展示不同的代码：分别是下拉菜单和输入框两种</span></span><br><span class="line">        <span class="keyword">if</span> (question.answerType === AnswerType.Choice) &#123;</span><br><span class="line">            <span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">'select'</span>);</span><br><span class="line">            <span class="keyword">var</span> len = question.choices.length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> option = <span class="built_in">document</span>.createElement(<span class="string">'option'</span>);</span><br><span class="line">                option.text = question.choices[i];</span><br><span class="line">                option.value = question.choices[i];</span><br><span class="line">                input.appendChild(option);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (question.answerType === AnswerType.Input) &#123;</span><br><span class="line">            <span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>);</span><br><span class="line">            input.type = <span class="string">'text'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        answer.appendChild(input);</span><br><span class="line">        questionWrapper.appendChild(questionLabel);</span><br><span class="line">        questionWrapper.appendChild(answer);</span><br><span class="line">        target.appendChild(questionWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 遍历所有的问题列表进行渲染</span></span><br><span class="line">        render: <span class="function"><span class="keyword">function</span> (<span class="params">target, questions</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; questions.length; i++) &#123;</span><br><span class="line">                renderQuestion(target, questions[i]);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> questions = [</span><br><span class="line">    question(<span class="string">'Have you used tobacco products within the last 30 days?'</span>,AnswerType.Choice, [<span class="string">'Yes'</span>, <span class="string">'No'</span>]),</span><br><span class="line">    question(<span class="string">'What medications are you currently using?'</span>, AnswerType.Input)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> questionRegion = <span class="built_in">document</span>.getElementById(<span class="string">'questions'</span>);</span><br><span class="line">view.render(questionRegion, questions);</span><br></pre></td></tr></table></figure>
<p>上面代码有一个限制，就是如果再增加一个问题类型的话，那就需要再次修改<code>renderQuestion</code>里的条件语句，这明显违反了开闭原则。重构后的代码如下：（符合开闭原则）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">questionCreator</span>(<span class="params">spec, my</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    my = my || &#123;&#125;;</span><br><span class="line">    my.label = spec.label;</span><br><span class="line"></span><br><span class="line">    my.renderInput = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">"not implemented"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    that.render = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> questionWrapper = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        questionWrapper.className = <span class="string">'question'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> questionLabel = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">        questionLabel.className = <span class="string">'question-label'</span>;</span><br><span class="line">        <span class="keyword">var</span> label = <span class="built_in">document</span>.createTextNode(spec.label);</span><br><span class="line">        questionLabel.appendChild(label);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> answer = my.renderInput();</span><br><span class="line"></span><br><span class="line">        questionWrapper.appendChild(questionLabel);</span><br><span class="line">        questionWrapper.appendChild(answer);</span><br><span class="line">        <span class="keyword">return</span> questionWrapper;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> that;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">choiceQuestionCreator</span>(<span class="params">spec</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> my = &#123;&#125;,</span><br><span class="line">        that = questionCreator(spec, my);</span><br><span class="line"></span><br><span class="line">    my.renderInput = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">'select'</span>);</span><br><span class="line">        <span class="keyword">var</span> len = spec.choices.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> option = <span class="built_in">document</span>.createElement(<span class="string">'option'</span>);</span><br><span class="line">            option.text = spec.choices[i];</span><br><span class="line">            option.value = spec.choices[i];</span><br><span class="line">            input.appendChild(option);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> that;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inputQuestionCreator</span>(<span class="params">spec</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> my = &#123;&#125;,</span><br><span class="line">        that = questionCreator(spec, my);</span><br><span class="line"></span><br><span class="line">    my.renderInput = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> input = <span class="built_in">document</span>.createElement(<span class="string">'input'</span>);</span><br><span class="line">        input.type = <span class="string">'text'</span>;</span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> that;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> view = &#123;</span><br><span class="line">    render: <span class="function"><span class="keyword">function</span>(<span class="params">target, questions</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; questions.length; i++) &#123;</span><br><span class="line">            target.appendChild(questions[i].render());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> questions = [</span><br><span class="line">    choiceQuestionCreator(&#123;</span><br><span class="line">        label: <span class="string">'Have you used tobacco products within the last 30 days?'</span>,</span><br><span class="line">        choices: [<span class="string">'Yes'</span>, <span class="string">'No'</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    inputQuestionCreator(&#123;</span><br><span class="line">        label: <span class="string">'What medications are you currently using?'</span></span><br><span class="line">    &#125;)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> questionRegion = <span class="built_in">document</span>.getElementById(<span class="string">'questions'</span>);</span><br><span class="line">view.render(questionRegion, questions);</span><br></pre></td></tr></table></figure>
<p>重构后的代码可以很容易的地进行扩展了，从而达到了开闭原则的要求。</p>
<p>相关阅读：<a href="http://www.cnblogs.com/TomXu/archive/2012/01/09/2306329.html" target="_blank" rel="noopener">深入理解JavaScript系列（7）：S.O.L.I.D五大原则之开闭原则OCP</a></p>
<h3 id="里氏替换原则-Liskov-Substitution-Principle"><a href="#里氏替换原则-Liskov-Substitution-Principle" class="headerlink" title="里氏替换原则(Liskov Substitution Principle)"></a>里氏替换原则(Liskov Substitution Principle)</h3><p><a href="https://zh.wikipedia.org/wiki/%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">里氏替换原则</a>的描述如下：</p>
<blockquote>
<p>Subtypes must be substitutable for their base types.<br>派生类型必须可以替换它的基类型</p>
</blockquote>
<h4 id="正方形和矩形"><a href="#正方形和矩形" class="headerlink" title="正方形和矩形"></a>正方形和矩形</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 矩形对象</span></span><br><span class="line"><span class="keyword">var</span> rectangle = &#123;</span><br><span class="line">    length: <span class="number">0</span>,</span><br><span class="line">    width: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正方形(宽高一致)</span></span><br><span class="line"><span class="keyword">var</span> square = &#123;&#125;;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> length = <span class="number">0</span>, width = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(square, <span class="string">"length"</span>, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> length; &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123; length = width = value; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(square, <span class="string">"width"</span>, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> width; &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123; length = width = value; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="function"><span class="keyword">function</span>(<span class="params">rectangle</span>) </span>&#123;</span><br><span class="line">    rectangle.length = <span class="number">3</span>;</span><br><span class="line">    rectangle.width = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(rectangle.length);</span><br><span class="line">    <span class="built_in">console</span>.log(rectangle.width);</span><br><span class="line">    <span class="built_in">console</span>.log(rectangle.length * rectangle.width);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正方形代替矩形</span></span><br><span class="line">g(square);</span><br></pre></td></tr></table></figure>
<p>当我们使用正方形代替矩形执行代码的时，会发现得到的结果并不是我们所期待的结果，这明显违法了里氏替换原则。</p>
<h4 id="鸵鸟到底是不是鸟？"><a href="#鸵鸟到底是不是鸟？" class="headerlink" title="鸵鸟到底是不是鸟？"></a>鸵鸟到底是不是鸟？</h4><p>一讲到鸟，就认为它能飞，有的鸟确实能飞，但不是所有的鸟都能飞。问题就是出在这里。如果以“飞”的行为作为衡量“鸟”的标准的话，鸵鸟显然不是鸟。如果按照生物学的划分标准：有翅膀、有羽毛等特性作为衡量“鸟”的标准的话，鸵鸟理所当然就是鸟了。鸵鸟没有“飞”的行为，我们强行给它加上了这个行为，所以在面对“飞越太平洋”的需求时，代码就会出现运行期故障，故设计要依赖于用户要求和具体环境而定。</p>
<h4 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h4><p><a href="http://www.cnblogs.com/TomXu/archive/2012/01/10/2310244.html" target="_blank" rel="noopener">深入理解JavaScript系列（8）：S.O.L.I.D五大原则之里氏替换原则LSP</a><br><a href="http://blog.csdn.net/Bitou_Von/article/details/4210654" target="_blank" rel="noopener">架构师之路之里氏代换原则</a></p>
<h3 id="接口隔离原则-Interface-Segregation-Principle"><a href="#接口隔离原则-Interface-Segregation-Principle" class="headerlink" title="接口隔离原则(Interface Segregation Principle)"></a>接口隔离原则(Interface Segregation Principle)</h3><p><a href="https://zh.wikipedia.org/wiki/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">接口隔离原则</a>的描述如下：</p>
<blockquote>
<p>Clients should not be forced to depend on methods they do not use.<br>不应该强迫客户依赖于它们不用的方法</p>
</blockquote>
<p>目前为止(2017-04-22)，JavaScript 没有接口的特性，不像 Java 等一些语言原生就提供接口的特性。当然 JavaScript 也有自己的一些实现，有兴趣的读者可参阅《JavaScript设计模式》一书（作者：Ross Harmes），其中有探讨在 JavaScript 中模仿接口的实现。</p>
<p>相关阅读：<a href="http://www.cnblogs.com/TomXu/archive/2012/02/14/2330137.html" target="_blank" rel="noopener">深入理解JavaScript系列（21）：S.O.L.I.D五大原则之接口隔离原则ISP</a></p>
<h3 id="依赖倒置原则-Dependency-Inversion-Principle"><a href="#依赖倒置原则-Dependency-Inversion-Principle" class="headerlink" title="依赖倒置原则(Dependency Inversion Principle)"></a>依赖倒置原则(Dependency Inversion Principle)</h3><p><a href="https://zh.wikipedia.org/wiki/%E4%BE%9D%E8%B5%96%E5%8F%8D%E8%BD%AC%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">依赖倒置原则</a>的描述如下：</p>
<blockquote>
<p>A. High-level modules should not depend on low-level modules.  Both should depend on abstractions.<br>高层模块不应该依赖于低层模块，二者都应该依赖于抽象</p>
<p>B. Abstractions should not depend upon details.  Details should depend upon abstractions.<br>抽象不应该依赖于细节，细节应该依赖于抽象</p>
</blockquote>
<p>依赖倒置原则的最重要问题就是确保应用程序或框架的主要组件从非重要的底层组件实现细节解耦出来，这将确保程序的最重要的部分不会因为低层次组件的变化修改而受影响。下面给出一个示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$.fn.trackMap = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;</span><br><span class="line">        <span class="comment">/* defaults */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    options = $.extend(&#123;&#125;, defaults, options);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mapOptions = &#123;</span><br><span class="line">        center: <span class="keyword">new</span> google.maps.LatLng(options.latitude,options.longitude),</span><br><span class="line">        zoom: <span class="number">12</span>,</span><br><span class="line">        mapTypeId: google.maps.MapTypeId.ROADMAP</span><br><span class="line">    &#125;,</span><br><span class="line">        map = <span class="keyword">new</span> google.maps.Map(<span class="keyword">this</span>[<span class="number">0</span>], mapOptions),</span><br><span class="line">        pos = <span class="keyword">new</span> google.maps.LatLng(options.latitude,options.longitude);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> marker = <span class="keyword">new</span> google.maps.Marker(&#123;</span><br><span class="line">        position: pos,</span><br><span class="line">        title: options.title,</span><br><span class="line">        icon: options.icon</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    marker.setMap(map);</span><br><span class="line"></span><br><span class="line">    options.feed.update(<span class="function"><span class="keyword">function</span>(<span class="params">latitude, longitude</span>) </span>&#123;</span><br><span class="line">        marker.setMap(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">var</span> newLatLng = <span class="keyword">new</span> google.maps.LatLng(latitude, longitude);</span><br><span class="line">        marker.position = newLatLng;</span><br><span class="line">        marker.setMap(map);</span><br><span class="line">        map.setCenter(newLatLng);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> updater = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// private properties</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        update: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">            updateMap = callback;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#map_canvas"</span>).trackMap(&#123;</span><br><span class="line">    latitude: <span class="number">35.044640193770725</span>,</span><br><span class="line">    longitude: <span class="number">-89.98193264007568</span>,</span><br><span class="line">    icon: <span class="string">'http://bit.ly/zjnGDe'</span>,</span><br><span class="line">    title: <span class="string">'Tracking Number: 12345'</span>,</span><br><span class="line">    feed: updater</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码中 trackMap 函数有2个依赖：第三方的Google Maps API和Location feed。如果需要切换不同的地图提供商的话那就不得不对trackMap函数进行重写。对此我们应该实现一个适配Google Maps API的对象。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$.fn.trackMap = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> defaults = &#123;</span><br><span class="line">        <span class="comment">/* defaults */</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    options = $.extend(&#123;&#125;, defaults, options);</span><br><span class="line"></span><br><span class="line">    options.provider.showMap(</span><br><span class="line">        <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        options.latitude,</span><br><span class="line">        options.longitude,</span><br><span class="line">        options.icon,</span><br><span class="line">        options.title);</span><br><span class="line"></span><br><span class="line">    options.feed.update(<span class="function"><span class="keyword">function</span>(<span class="params">latitude, longitude</span>) </span>&#123;</span><br><span class="line">        options.provider.updateMap(latitude, longitude);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#map_canvas"</span>).trackMap(&#123;</span><br><span class="line">    latitude: <span class="number">35.044640193770725</span>,</span><br><span class="line">    longitude: <span class="number">-89.98193264007568</span>,</span><br><span class="line">    icon: <span class="string">'http://bit.ly/zjnGDe'</span>,</span><br><span class="line">    title: <span class="string">'Tracking Number: 12345'</span>,</span><br><span class="line">    feed: updater,</span><br><span class="line">    provider: trackMap.googleMapsProvider</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">trackMap.googleMapsProvider = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> marker, map;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        showMap: <span class="function"><span class="keyword">function</span>(<span class="params">element, latitude, longitude, icon, title</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> mapOptions = &#123;</span><br><span class="line">                center: <span class="keyword">new</span> google.maps.LatLng(latitude, longitude),</span><br><span class="line">                zoom: <span class="number">12</span>,</span><br><span class="line">                mapTypeId: google.maps.MapTypeId.ROADMAP</span><br><span class="line">            &#125;,</span><br><span class="line">                pos = <span class="keyword">new</span> google.maps.LatLng(latitude, longitude);</span><br><span class="line"></span><br><span class="line">            map = <span class="keyword">new</span> google.maps.Map(element, mapOptions);</span><br><span class="line"></span><br><span class="line">            marker = <span class="keyword">new</span> google.maps.Marker(&#123;</span><br><span class="line">                position: pos,</span><br><span class="line">                title: title,</span><br><span class="line">                icon: icon</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            marker.setMap(map);</span><br><span class="line">        &#125;,</span><br><span class="line">        updateMap: <span class="function"><span class="keyword">function</span>(<span class="params">latitude, longitude</span>) </span>&#123;</span><br><span class="line">            marker.setMap(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">var</span> newLatLng = <span class="keyword">new</span> google.maps.LatLng(latitude,longitude);</span><br><span class="line">            marker.position = newLatLng;</span><br><span class="line">            marker.setMap(map);</span><br><span class="line">            map.setCenter(newLatLng);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>相关阅读：<a href="http://www.cnblogs.com/TomXu/archive/2012/02/15/2330143.html" target="_blank" rel="noopener">深入理解JavaScript系列（22）：S.O.L.I.D五大原则之依赖倒置原则DIP</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2016/javascript 随笔/" itemprop="url">
                  javascript 随笔
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-04T00:00:00+08:00" content="2016-11-04">
              2016-11-04
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本篇主要记录 javascript 中的一些特性，文章逻辑和排版比较随意，当然包含的内容，有很大的局限性，仅当草稿。</p>
<h3 id="随笔"><a href="#随笔" class="headerlink" title="随笔"></a>随笔</h3><h4 id="严格模式-use-strict"><a href="#严格模式-use-strict" class="headerlink" title="严格模式 (use strict)"></a>严格模式 (use strict)</h4><p>除了正常运行模式，ECMAScript 5 添加了第二种运行模式：“严格模式”（strict mode）。顾名思义，这种模式使得 JavaScript 在更严格的条件下运行。</p>
<p>设立”严格模式“的目的，主要有以下几个：</p>
<ul>
<li>消除 JavaScript 语法的一些不合理、不严谨之处，减少一些怪异行为;</li>
<li>增加更多报错的场合，消除代码运行的一些不安全之处，保证代码运行的安全；</li>
<li>提高编译器效率，增加运行速度；</li>
<li>为未来新版本的 JavaScript 做好铺垫；</li>
</ul>
<p>“严格模式”体现了 JavaScript 更合理、更安全、更严谨的发展方向。更多介绍可移步阅读 <a href="http://javascript.ruanyifeng.com/advanced/strict.html" target="_blank" rel="noopener">阮一峰 - 严格模式</a></p>
<h4 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h4><p>在 JavaScript 中，”一切皆对象”，数组和函数本质上都是对象，就连三种原始类型的值：数值、字符串、布尔值在一定条件下，也会自动转为对象，也就是原始类型的”包装对象”。</p>
<p>所谓”包装对象”，就是分别与数值、字符串、布尔值相对应的 <code>Number</code> 、 <code>String</code> 、 <code>Boolean</code> 三个原生对象。这三个原生对象可以把原始类型的值变成（包装成）对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1 = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>);</span><br><span class="line"><span class="keyword">var</span> v2 = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"abc"</span>);</span><br><span class="line"><span class="keyword">var</span> v3 = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> v1  <span class="comment">// "object"</span></span><br><span class="line"><span class="keyword">typeof</span> v2  <span class="comment">// "object"</span></span><br><span class="line"><span class="keyword">typeof</span> v3  <span class="comment">// "object"</span></span><br><span class="line"></span><br><span class="line">v1 === <span class="number">123</span>  <span class="comment">// false</span></span><br><span class="line">v2 === <span class="string">"abc"</span>  <span class="comment">// false</span></span><br><span class="line">v3 === <span class="literal">true</span>  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"abc"</span>);</span><br><span class="line">v.length <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="string">"abc"</span>.length <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>上面代码对字符串 abc 调用 length 属性，实际上是将字符串自动转为 String 对象的实例，再在其上调用 length 属性。这就叫原始类型的自动转换。</p>
<p>abc 是一个字符串，属于原始类型，本身不能调用任何方法和属性。但当对 abc 调用 length 属性时，JavaScript 引擎自动将 abc 转化为一个包装对象实例，然后再对这个实例调用 length 属性，在得到返回值后，再自动销毁这个临时生成的包装对象实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'abc'</span>.charAt === <span class="built_in">String</span>.prototype.charAt   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>注意：如果直接对原始类型的变量添加属性，是无效。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">"abc"</span>;</span><br><span class="line">s.p = <span class="number">123</span>;</span><br><span class="line">s.p  <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h4><p>根据 ECMAScript 标准，JavaScript 中只有一种数字类型：基于 <a href="https://zh.wikipedia.org/zh-cn/IEEE_754" target="_blank" rel="noopener">IEEE 754</a> 标准的双精度 64 位二进制格式的值，它并没有为整数给出一种特定的类型。除了能够表示浮点数外，还有一些带符号的值：<code>+Infinity</code>，<code>-Infinity</code>，<code>NaN</code></p>
<p>注意浮点数的运算中，可能会出现“舍入误差”。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.1 + 0.2 = 0.30000000000000004</span><br></pre></td></tr></table></figure>
<p>产生这种误差的原因：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0.1 =&gt; 0.0001 1001 1001 1001…（无限循环）</span><br><span class="line">0.2 =&gt; 0.0011 0011 0011 0011…（无限循环）</span><br></pre></td></tr></table></figure></p>
<p>双精度浮点数的小数部分最多支持 52 位，所以两者相加之后得到这么一串 <code>0.0100110011001100110011001100110011001100110011001100</code> 因浮点数小数位的限制而截断的二进制数字，这时候，我们再把它转换为十进制，就成了 0.30000000000000004</p>
<p>相关阅读：<a href="http://www.chengfeilong.com/toFixed" target="_blank" rel="noopener">http://www.chengfeilong.com/toFixed</a></p>
<h4 id="标记语句-labeled-statement"><a href="#标记语句-labeled-statement" class="headerlink" title="标记语句 (labeled statement)"></a>标记语句 (labeled statement)</h4><p>通常和 break 或 continue 语句一起使用。标记就是在一条语句前面加个可以引用的标识符，任何不是保留关键字的 javascript 标识符。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i, j;</span><br><span class="line"></span><br><span class="line">loop1:</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">   loop2:</span><br><span class="line">   <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">1</span> &amp;&amp; j == <span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">continue</span> loop1;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"i = "</span> + i + <span class="string">", j = "</span> + j);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i, j;</span><br><span class="line"></span><br><span class="line">loop1:</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">   loop2:</span><br><span class="line">   <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i == <span class="number">1</span> &amp;&amp; j == <span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">break</span> loop1;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"i = "</span> + i + <span class="string">", j = "</span> + j);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可参阅 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label" target="_blank" rel="noopener">labeled statement</a></p>
<h4 id="判断-NaN-的方法"><a href="#判断-NaN-的方法" class="headerlink" title="判断 NaN 的方法"></a>判断 NaN 的方法</h4><p>isNaN 方法可以用来判断一个值是否为 NaN，isNaN 只对数值有效，如果传入其他值，会被先转成数值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isNaN</span>(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="number">123</span>) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="string">'Hello'</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>(&#123;&#125;) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>([<span class="string">'xzy'</span>]) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>([]) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">isNaN</span>([<span class="number">123</span>]) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">isNaN</span>([<span class="number">123</span>,<span class="number">456</span>]) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>([<span class="string">'123'</span>]) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>因此判断 NaN 时要注意数据类型的转换。也可以自己封装一个 isNaN 函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myIsNaN</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">'number'</span> &amp;&amp; <span class="built_in">isNaN</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用了 NaN 不等于自身的特性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myIsNaN</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value !== value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果数组中包含 NaN 下面的方法不适用]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">NaN</span>].indexOf(<span class="literal">NaN</span>) <span class="comment">// -1</span></span><br><span class="line">[<span class="literal">NaN</span>].lastIndexOf(<span class="literal">NaN</span>) <span class="comment">// -1</span></span><br></pre></td></tr></table></figure>
<p>这是因为这两个方法内部，使用严格相等运算符（===）进行比较，而 NaN 是唯一一个不等于自身的值。</p>
<h4 id="字符处理"><a href="#字符处理" class="headerlink" title="字符处理"></a>字符处理</h4><p>在 javascript 中处理字符需要注意一些特殊字符，在这里紧给出简单例子。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'\ud834\udf06'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s);  <span class="comment">// 𝌆</span></span><br><span class="line"><span class="built_in">console</span>.log(s.length);  <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/^.$/</span>.test(s));  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>特殊字符 <code>𝌆</code> length 属性为 2 ，匹配单个字符的正则表达式会失败。具体原因可<a href="http://javascript.ruanyifeng.com/grammar/string.html#toc5" target="_blank" rel="noopener">点击查阅</a></p>
<h4 id="数组本质"><a href="#数组本质" class="headerlink" title="数组本质"></a>数组本质</h4><p>数组属于一种特殊的对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="built_in">Object</span>.keys(arr);  <span class="comment">// ['0', '1', '2']</span></span><br></pre></td></tr></table></figure>
<p><code>Object.keys</code> 方法返回数组的所有键名。</p>
<p>还需要要注意数组的空位，即 <code>[,1,,3]</code> 这类型数组遍历的时候需要注意，利用 <code>for ... in</code> 结构会跳过空位。如果读取数组的空位，则返回 <code>undefined</code>。</p>
<p>空位和 <code>undefined</code> 是不一样的，如果数字某个位置是 <code>undefined</code> 遍历时不会被跳过。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys([,<span class="number">1</span>,,<span class="number">3</span>]);  <span class="comment">// ['1', '3']</span></span><br></pre></td></tr></table></figure>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><h5 id="且运算符-amp-amp"><a href="#且运算符-amp-amp" class="headerlink" title="且运算符 (&amp;&amp;)"></a>且运算符 (&amp;&amp;)</h5><p>且运算符的运算规则是：如果第一个运算子的布尔值为true，则返回第二个运算子的值（注意是值，不是布尔值）；如果第一个运算子的布尔值为false，则直接返回第一个运算子的值，且不再对第二个运算子求值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"t"</span> &amp;&amp; <span class="string">""</span> <span class="comment">// ""</span></span><br><span class="line"><span class="string">"t"</span> &amp;&amp; <span class="string">"f"</span> <span class="comment">// "f"</span></span><br><span class="line"><span class="string">"t"</span> &amp;&amp; (<span class="number">1</span>+<span class="number">2</span>) <span class="comment">// 3</span></span><br><span class="line"><span class="string">""</span> &amp;&amp; <span class="string">"f"</span> <span class="comment">// ""</span></span><br><span class="line"><span class="string">""</span> &amp;&amp; <span class="string">""</span> <span class="comment">// ""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">(<span class="number">1</span><span class="number">-1</span>) &amp;&amp; (x+=<span class="number">1</span>) <span class="comment">// 0</span></span><br><span class="line">x <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i !== <span class="number">0</span> )&#123;</span><br><span class="line">  doSomething();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"></span><br><span class="line">i &amp;&amp; doSomething();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> &amp;&amp; <span class="string">'foo'</span> &amp;&amp; <span class="string">''</span> &amp;&amp; <span class="number">4</span> &amp;&amp; <span class="string">'foo'</span> &amp;&amp; <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h5 id="或运算符"><a href="#或运算符" class="headerlink" title="或运算符 (||)"></a>或运算符 (||)</h5><p>或运算符的运算规则是：如果第一个运算子的布尔值为true，则返回第一个运算子的值，且不再对第二个运算子求值；如果第一个运算子的布尔值为false，则返回第二个运算子的值。</p>
<p>你可以<a href="http://javascript.ruanyifeng.com/grammar/operator.html" target="_blank" rel="noopener">点击阅读</a>有关运算符的知识，如位运算符，void 运算符的一些用法。</p>
<h4 id="Math-对象"><a href="#Math-对象" class="headerlink" title="Math 对象"></a>Math 对象</h4><p>Math 对象是 JavaScript 的内置对象，提供一系列数学常数和数学方法。该对象不是构造函数，所以不能生成实例，所有的属性和方法都必须在 Math 对象上调用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Math</span>()  <span class="comment">// TypeError: Math is not a constructor</span></span><br></pre></td></tr></table></figure>
<h4 id="JSON-对象"><a href="#JSON-对象" class="headerlink" title="JSON 对象"></a>JSON 对象</h4><p>有关 JSON 对象的详细介绍可点击阅读: <a href="http://javascript.ruanyifeng.com/stdlib/json.html" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/stdlib/json.html</a> 其中像 <code>JSON.stringify()</code> <code>JSON.parse()</code> 的方法有多个参数。</p>
<h4 id="RegExp-对象"><a href="#RegExp-对象" class="headerlink" title="RegExp 对象"></a>RegExp 对象</h4><p>有关 JavaScript 的正则可点击阅读: <a href="http://javascript.ruanyifeng.com/stdlib/regexp.html" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/stdlib/regexp.html</a></p>
<h4 id="new-命令"><a href="#new-命令" class="headerlink" title="new 命令"></a>new 命令</h4><p><code>new</code> 命令的作用，就是执行构造函数，返回一个实例对象。一般构造函数首字母大写。注意：应该避免出现不使用 new 命令、直接调用构造函数的情况，原因如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Vehicle = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.price = <span class="number">1000</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> v = Vehicle();</span><br><span class="line">v.price  <span class="comment">// TypeError: Cannot read property 'price' of undefined(…)</span></span><br><span class="line"></span><br><span class="line">price <span class="comment">// 1000</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，调用 Vehicle 构造函数时，忘了加上 new 命令。结果 price 属性变成了全局变量，而变量 v 变成了 undefined</p>
<p>为了保证构造函数必须与 new 命令一起使用，一个解决办法是，在构造函数内部使用严格模式，即第一行加上 <code>use strict</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fubar</span>(<span class="params">foo, bar</span>)</span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._foo = foo;</span><br><span class="line">  <span class="keyword">this</span>._bar = bar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Fubar()  <span class="comment">// ypeError: Cannot set property '_foo' of undefined(…)</span></span><br></pre></td></tr></table></figure>
<p>上面代码的 Fubar 为构造函数，<code>use strict</code> 命令保证了该函数在严格模式下运行。由于在严格模式中，函数内部的 this 不能指向全局对象，默认等于 undefined ，导致不加 new 调用会报错。( JavaScript 不允许对 undefined 添加属性)</p>
<p>另一个解决办法，是在构造函数内部判断是否使用 new 命令，如果发现没有使用，则直接返回一个实例对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fubar</span>(<span class="params">foo, bar</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Fubar)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Fubar(foo, bar);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._foo = foo;</span><br><span class="line">  <span class="keyword">this</span>._bar = bar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Fubar(<span class="number">1</span>, <span class="number">2</span>)._foo <span class="comment">// 1</span></span><br><span class="line">(<span class="keyword">new</span> Fubar(<span class="number">1</span>, <span class="number">2</span>))._foo <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>上面代码中的构造函数，不管加不加 new 命令，都会得到同样的结果。<br>更详细可阅读 <a href="http://javascript.ruanyifeng.com/oop/basic.html#toc2" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/oop/basic.html#toc2</a></p>
<h4 id="Function-prototype-call"><a href="#Function-prototype-call" class="headerlink" title="Function.prototype.call"></a>Function.prototype.call</h4><p>这里紧对 <code>Function.prototype.call</code> 做个简单的介绍，有关更详细的介绍可以阅读 <a href="http://es5.github.io/#x15.3.4.4" target="_blank" rel="noopener">Annotated ECMAScript 5.1 </a> 语言规范里的介绍,在此之前先看看下面代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'fsjohnhuang'</span></span><br><span class="line">&#125;</span><br><span class="line">test.call() <span class="comment">// A</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.call(test) <span class="comment">// B</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.call.call(test) <span class="comment">// C</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.call.call(<span class="built_in">Function</span>.prototype.call, test) <span class="comment">// D</span></span><br></pre></td></tr></table></figure>
<p>运行结果： <code>A C D</code> 控制台显示 hello world 并返回 fsjohnhuang <code>B</code> 返回 undefined 且不会调用 test 函数。这是怎么回事？</p>
<p>以下是参照规范的伪代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.call = <span class="function"><span class="keyword">function</span>(<span class="params">thisArg, arg1, arg2, ...</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// this 指向调用 call 的那个对象或函数</span></span><br><span class="line">  <span class="comment">// 如 Function.prototype.call(test) 那么这时 this 就是 Function.prototype</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 调用内部的 IsCallable(this) 检查是否可调用，返回 false 则抛 TypeError</span></span><br><span class="line">  <span class="keyword">if</span> (![[IsCallable]](<span class="keyword">this</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 创建一个空列表</span></span><br><span class="line">  <span class="comment">// 3. 将 arg1 及后面的入参保存到 argList 中</span></span><br><span class="line">  <span class="keyword">var</span> argList = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 调用内部的[[Call]]函数</span></span><br><span class="line">  <span class="keyword">return</span> [[Call]](<span class="keyword">this</span>, thisArg, argList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>明白了这层关系之后，就比较容易的推导上面例子的运行的一个流程了。再看一下两个例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice = <span class="built_in">Function</span>.prototype.call.bind(<span class="built_in">Array</span>.prototype.slice);</span><br><span class="line"></span><br><span class="line">slice([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">0</span>, <span class="number">1</span>) <span class="comment">// [1]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.resolve = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　<span class="keyword">this</span>.forEach(<span class="built_in">Function</span>.prototype.call, <span class="built_in">Function</span>.prototype.call)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> cbs = [<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">1</span>)&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>)&#125;]</span><br><span class="line">cbs.resolve() <span class="comment">// 1 2</span></span><br></pre></td></tr></table></figure>
<p>可以参考 <a href="http://www.cnblogs.com/fsjohnhuang/p/4160942.html" target="_blank" rel="noopener">JS魔法堂：再次认识 Function.prototype.call</a></p>
<h4 id="instanceof-运算符深入剖析"><a href="#instanceof-运算符深入剖析" class="headerlink" title="instanceof 运算符深入剖析"></a>instanceof 运算符深入剖析</h4><p>在此之前先看看 instanceof 常规用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(foo <span class="keyword">instanceof</span> Foo)  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Aoo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Foo.prototype = <span class="keyword">new</span> Aoo();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line"><span class="built_in">console</span>.log(foo <span class="keyword">instanceof</span> Foo)  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(foo <span class="keyword">instanceof</span> Aoo)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>instanceof 复杂用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Number</span> <span class="keyword">instanceof</span> <span class="built_in">Number</span>);  <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span> <span class="keyword">instanceof</span> <span class="built_in">String</span>);  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Foo <span class="keyword">instanceof</span> <span class="built_in">Function</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Foo <span class="keyword">instanceof</span> Foo);  <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>要理解上面代码的执行结果，需要从两个方面着手：语言规范中是如何定义这个运算符的 和 JavaScript 原型继承机制。</p>
<p>规范中 instanceof 运算符定义,这里给出伪代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instance_of</span>(<span class="params">L, R</span>) </span>&#123;  <span class="comment">// L 表示左表达式, R 表示右表达式</span></span><br><span class="line">  <span class="keyword">var</span> O = R.prototype;  <span class="comment">// 取 R 的显示原型</span></span><br><span class="line">  L = L.__proto__;  <span class="comment">// 取 L 的隐式原型</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (L === <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (O === L)  <span class="comment">// 这里重点：当 O 严格等于 L 时，返回 true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    L = L.__proto__;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>JavaScript 原型继承机制：在原型继承结构里面，规范中用 <code>[[Prototype]]</code> 表示对象隐式的原型，在 JavaScript 中用 <strong>proto</strong> 表示。所有 JavaScript 对象都有 <code>__proto__</code> 属性，但只有 <code>Object.prototype.__proto__</code> 为 <code>null</code> 这个属性指向它的原型对象，即构造函数的 prototype<br>属性。</p>
<p>原型继承图</p>
<p><img src="/blog/myimages/2016-11-04_01.jpg" alt="" title="JavaScript 原型链"></p>
<p>下面简要分析下 <code>console.log(Foo instanceof Foo)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为了方便表述，首先区分左侧表达式和右侧表达式</span></span><br><span class="line"> FooL = Foo, FooR = Foo;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 下面根据规范逐步推演</span></span><br><span class="line"> O = FooR.prototype = Foo.prototype</span><br><span class="line"> L = FooL.__proto__ = <span class="built_in">Function</span>.prototype</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 第一次判断</span></span><br><span class="line"> O != L</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 循环再次查找 L 是否还有 __proto__</span></span><br><span class="line"> L = <span class="built_in">Function</span>.prototype.__proto__ = <span class="built_in">Object</span>.prototype</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 第二次判断</span></span><br><span class="line"> O != L</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 再次循环查找 L 是否还有 __proto__</span></span><br><span class="line"> L = <span class="built_in">Object</span>.prototype.__proto__ = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 第三次判断</span></span><br><span class="line"> L == <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 返回 false</span></span><br></pre></td></tr></table></figure>
<p>再看看下面例子的运行结果，帮助理解</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype === <span class="built_in">Function</span>.__proto__  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.prototype === <span class="built_in">Number</span>.__proto__  <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.__proto__ === <span class="built_in">Object</span>.__proto__  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">String</span>.__proto__ === <span class="built_in">Object</span>.__proto__  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>相关文章可查阅<br><a href="http://www.ibm.com/developerworks/cn/web/1306_jiangjj_jsinstanceof/" target="_blank" rel="noopener">JavaScript instanceof 运算符深入剖析</a><br><a href="http://javascript.ruanyifeng.com/oop/inheritance.html" target="_blank" rel="noopener">JavaScript 继承</a><br><a href="https://github.com/creeperyang/blog/issues/9" target="_blank" rel="noopener">从<strong>proto</strong>和prototype来深入理解JS对象和原型链</a></p>
<h4 id="Event-对象"><a href="#Event-对象" class="headerlink" title="Event 对象"></a>Event 对象</h4><p>事件发生以后，会生成一个事件对象，作为参数传给监听函数。浏览器原生提供一个 Event 对象，所有的事件都是这个对象的实例，或者说继承了 Event.prototype 对象。</p>
<p>Event 对象本身就是一个构造函数，可以用来生成新的实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event = <span class="keyword">new</span> Event(typeArg, eventInit);</span><br></pre></td></tr></table></figure>
<p>Event 构造函数接受两个参数。第一个参数是字符串，表示事件的名称；第二个参数是一个对象，表示事件对象的配置。该参数可以有以下两个属性。</p>
<ul>
<li>bubbles：布尔值，可选，默认为 false ，表示事件对象是否冒泡。</li>
<li>cancelable：布尔值，可选，默认为 false ，表示事件是否可以被取消。</li>
</ul>
<h5 id="自定义事件和事件模拟"><a href="#自定义事件和事件模拟" class="headerlink" title="自定义事件和事件模拟"></a>自定义事件和事件模拟</h5><p>除了浏览器预定义的那些事件，用户还可以自定义事件，然后手动触发。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建事件实例</span></span><br><span class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> Event(<span class="string">'build'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加监听函数</span></span><br><span class="line">elem.addEventListener(<span class="string">'build'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; ... &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发事件</span></span><br><span class="line">elem.dispatchEvent(event);</span><br></pre></td></tr></table></figure>
<p>上面代码触发了自定义事件，该事件会层层向上冒泡。在冒泡过程中，如果有一个元素定义了该事件的监听函数，该监听函数就会触发。</p>
<p>Event 构造函数只能指定事件名，不能在事件上绑定数据。如果需要在触发事件的同时，传入指定的数据，需要使用 <code>CustomEvent</code> 构造函数生成自定义的事件对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myEvent = <span class="keyword">new</span> CustomEvent(<span class="string">"myevent"</span>, &#123;</span><br><span class="line">  detail: &#123;</span><br><span class="line">    foo: <span class="string">"bar"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  bubbles: <span class="literal">true</span>,</span><br><span class="line">  cancelable: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">el.addEventListener(<span class="string">'myevent'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + event.detail.foo);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">el.dispatchEvent(myEvent);</span><br></pre></td></tr></table></figure>
<p>由于 IE 不支持上述的两个 API ，如果在 IE 中自定义事件，需要其他写法，详细可阅读 <a href="http://javascript.ruanyifeng.com/dom/event.html#toc52" target="_blank" rel="noopener">阮一峰 - 自定义事件和事件模拟</a></p>
<p>注意： <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="noopener">addEventListener</a> 方法的第二个参数是实现 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventListener" target="_blank" rel="noopener">EventListener</a> 接口的一个对象或函数，具体应用可以看 <a href="https://github.com/cubiq/iscroll" target="_blank" rel="noopener">iscroll</a></p>
<h5 id="事件的传播"><a href="#事件的传播" class="headerlink" title="事件的传播"></a>事件的传播</h5><p>当一个事件发生以后，它会在不同的 DOM 节点之间传播(propagation)。这种传播分成三个阶段：</p>
<ul>
<li>第一阶段：从 window 对象传导到目标节点，称为“捕获阶段”（capture phase）。</li>
<li>第二阶段：在目标节点上触发，称为“目标阶段”（target phase）。</li>
<li>第三阶段：从目标节点传导回window对象，称为“冒泡阶段”（bubbling phase）。</li>
</ul>
<p>假设 html 结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;div&quot;&gt;&lt;p id=&quot;p&quot;&gt;content&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oDiv = <span class="built_in">document</span>.getElementById(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> oP   = <span class="built_in">document</span>.getElementById(<span class="string">'p'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myEvent = <span class="keyword">new</span> CustomEvent(<span class="string">"myevent"</span>, &#123;</span><br><span class="line">  detail: &#123;</span><br><span class="line">    foo: <span class="string">"bar"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  bubbles: <span class="literal">true</span>,</span><br><span class="line">  cancelable: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> phases = &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">'capture'</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">'target'</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">'bubble'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> callback = <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">var</span> tag = event.currentTarget.tagName;</span><br><span class="line">                  <span class="keyword">var</span> phase = phases[event.eventPhase];</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">"Tag: '"</span> + tag + <span class="string">"'. EventPhase: '"</span> + phase + <span class="string">"'"</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">oDiv.addEventListener(<span class="string">'myevent'</span>, callback, <span class="literal">true</span>);</span><br><span class="line">oDiv.addEventListener(<span class="string">'myevent'</span>, callback, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">oP.addEventListener(<span class="string">'myevent'</span>, callback, <span class="literal">true</span>);</span><br><span class="line">oP.addEventListener(<span class="string">'myevent'</span>, callback, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// oDiv.dispatchEvent(myEvent);</span></span><br><span class="line">oP.dispatchEvent(myEvent);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line"><span class="comment">// Tag: 'DIV'. EventPhase: 'capture'</span></span><br><span class="line"><span class="comment">// Tag: 'P'. EventPhase: 'target'</span></span><br><span class="line"><span class="comment">// Tag: 'P'. EventPhase: 'target'</span></span><br><span class="line"><span class="comment">// Tag: 'DIV'. EventPhase: 'bubble'</span></span><br></pre></td></tr></table></figure>
<p>上面代码采用自定义事件的方式，可以看出 myevent 事件被触发了四次： p 节点的捕获阶段和冒泡阶段各 1 次， div 节点的捕获阶段和冒泡阶段各 1 次。</p>
<ol>
<li>捕获阶段：事件从 div 向 p 传播时，触发 div 的 click 事件；</li>
<li>目标阶段：事件从 div 到达 p 时，触发 p 的 click 事件；</li>
<li>目标阶段：事件离开 p 时，触发 p 的 click 事件；</li>
<li>冒泡阶段：事件从 p 传回 div 时，再次触发 div 的 click 事件。</li>
</ol>
<p>注意：用户点击网页的时候，浏览器总是假定 click 事件的目标节点，就是点击位置的嵌套最深的那个节点。</p>
<p>事件传播的最上层对象是 window ，接着依次是 document ，html 和 body 。也就是说，如果 body 元素中有一个 div 元素，点击该元素。事件的传播顺序，在捕获阶段依次为 window、 document、 html、 body、 div ，在冒泡阶段依次为 div、 body、 html、 document、 window</p>
<p>这里只是简要的说明了有关事件的部分知识点，相关更多的介绍如：节点的操作，CSS 操作等 DOM 的相关知识可详细阅读 <a href="http://javascript.ruanyifeng.com/#toc4" target="_blank" rel="noopener">阮一峰 - DOM</a></p>
<p>PS:低版本IE不支持事件捕获</p>
<h4 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h4><p>setTimeout 和 setInterval 的运行机制是，将指定的代码移出本次执行，等到下一轮 Event Loop 时，再检查是否到了指定时间。如果到了，就执行对应的代码；如果不到，就等到再下一轮 Event Loop 时重新判断。这意味着， setTimeout 指定的代码，必须等到本次执行的所有代码都执行完，才会执行。</p>
<p>每一轮 Event Loop 时，都会将“任务队列”中需要执行的任务，一次执行完。 setTimeout 和 setInterval 都是把任务添加到“任务队列”的尾部。因此，它们实际上要等到当前脚本的所有同步任务执行完，然后再等到本次 Event Loop 的“任务队列”的所有任务执行完，才会开始执行。由于前面的任务到底需要多少时间执行完，是不确定的，所以没有办法保证， setTimeout 和 setInterval 指定的任务，一定会按照预定时间执行。</p>
<p>可以运行下面例子看看：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Timeout"</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"a() 开始运行"</span>);</span><br><span class="line">  b(x);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"a() 结束运行"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"b() 开始运行"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"传入的值为"</span> + y);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"b() 结束运行"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"当前任务开始"</span>);</span><br><span class="line">a(<span class="number">42</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"当前任务结束"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前任务开始</span></span><br><span class="line"><span class="comment">// a() 开始运行</span></span><br><span class="line"><span class="comment">// b() 开始运行</span></span><br><span class="line"><span class="comment">// 传入的值为42</span></span><br><span class="line"><span class="comment">// b() 结束运行</span></span><br><span class="line"><span class="comment">// a() 结束运行</span></span><br><span class="line"><span class="comment">// 当前任务结束</span></span><br><span class="line"><span class="comment">// Timeout</span></span><br></pre></td></tr></table></figure>
<p>应用：用户在输入框输入文本转换大写英文字母，假设页面上有一元素 <code>&lt;input type=&quot;text&quot; id=&quot;input-box&quot;&gt;</code> 脚本如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'input-box'</span>).onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.value = <span class="keyword">this</span>.value.toUpperCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'input-box'</span>).onkeypress = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.value = self.value.toUpperCase();</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可分别测试上面代码，看看异同。具体可参考阅读以下两篇文章：<br><a href="http://javascript.ruanyifeng.com/bom/engine.html" target="_blank" rel="noopener">阮一峰 - 浏览器的JavaScript引擎</a><br><a href="http://javascript.ruanyifeng.com/bom/timer.html" target="_blank" rel="noopener">阮一峰 - 定时器</a></p>
<p>有关于 Event Loop 的介绍可以阅读以下文章：<br><a href="http://www.cnblogs.com/xiaozhi_5638/p/4816265.html" target="_blank" rel="noopener">nodejs事件轮询详述</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop" target="_blank" rel="noopener">并发模型与Event Loop</a><br><a href="http://www.ruanyifeng.com/blog/2013/10/event_loop.html" target="_blank" rel="noopener">什么是 Event Loop？</a><br><a href="https://cnodejs.org/topic/50462f51329c5139760bff98" target="_blank" rel="noopener">理解Node.js的event loop</a></p>
<h4 id="JavaScript-的异步处理"><a href="#JavaScript-的异步处理" class="headerlink" title="JavaScript 的异步处理"></a>JavaScript 的异步处理</h4><p>JavaScript 语言的执行环境是”单线程”（single thread）。所谓”单线程”，就是指一次只能完成一件任务。如果有多个任务，就必须排队，前面一个任务完成，再执行后面一个任务。</p>
<p>这种模式的好处是实现起来比较简单，执行环境相对单纯；坏处是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。常见的浏览器无响应（假死），往往就是因为某一段 Javascript 代码长时间运行（比如死循环），导致整个页面卡在这个地方，其他任务无法执行。下文简要介绍在 JavaScript 中异步的处理方式。</p>
<h5 id="定时器方式"><a href="#定时器方式" class="headerlink" title="定时器方式"></a>定时器方式</h5><p>利用 <code>setTimeout</code> 最简单的一种和常用的异步处理方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h5 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        callback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回调函数的优点是简单、容易理解和部署，缺点是不利于代码的阅读和维护，各个部分之间高度耦合，使得程序结构混乱、流程难以追踪（尤其是回调函数嵌套的情况），而且每个任务只能指定一个回调函数。</p>
<h5 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h5><p>这种方法的优点是比较容易理解，可以绑定多个事件，每个事件可以指定多个回调函数。缺点是整个程序都要变成事件驱动型，运行流程会变得很不清晰。简单的例子就像 jQuery 绑定自定义事件然后达到一定条件后主动触发。</p>
<h5 id="发布-订阅模式"><a href="#发布-订阅模式" class="headerlink" title="发布/订阅模式"></a>发布/订阅模式</h5><p>该模式又叫观察者模式,它定义了对象间的一种一对多的依赖关系，以便一个对象的状态发生变化时，所有依赖于它的对象都得到通知并自动刷新。下面给出一个 <a href="https://github.com/addyosmani/pubsubz" target="_blank" rel="noopener">pubsubz</a> 的源码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params"> window, doc, undef </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> topics = &#123;&#125;,</span><br><span class="line">        subUid = <span class="number">-1</span>,</span><br><span class="line">        pubsubz =&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发布</span></span><br><span class="line">    pubsubz.publish = <span class="function"><span class="keyword">function</span> (<span class="params"> topic, args </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> subscribers = topics[topic],</span><br><span class="line">                len = subscribers ? subscribers.length : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (len--) &#123;</span><br><span class="line">                subscribers[len].func(topic, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订阅</span></span><br><span class="line">    pubsubz.subscribe = <span class="function"><span class="keyword">function</span> (<span class="params"> topic, func </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">            topics[topic] = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> token = (++subUid).toString();</span><br><span class="line">        topics[topic].push(&#123;</span><br><span class="line">            token: token,</span><br><span class="line">            func: func</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 退订</span></span><br><span class="line">    pubsubz.unsubscribe = <span class="function"><span class="keyword">function</span> (<span class="params"> token </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> m <span class="keyword">in</span> topics) &#123;</span><br><span class="line">            <span class="keyword">if</span> (topics[m]) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = topics[m].length; i &lt; j; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (topics[m][i].token === token) &#123;</span><br><span class="line">                        topics[m].splice(i, <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">return</span> token;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    getPubSubz = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pubsubz;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.pubsubz = getPubSubz();</span><br><span class="line"></span><br><span class="line">&#125;( <span class="keyword">this</span>, <span class="keyword">this</span>.document ));</span><br></pre></td></tr></table></figure>
<p>使用方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> testSubscriber = <span class="function"><span class="keyword">function</span>(<span class="params"> topics , data </span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( topics + <span class="string">": "</span> + data );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> testSubscription = pubsubz.subscribe( <span class="string">'example1'</span>, testSubscriber );</span><br><span class="line"></span><br><span class="line">pubsubz.publish( <span class="string">'example1'</span>, <span class="string">'hello world!'</span> );</span><br><span class="line">pubsubz.publish( <span class="string">'example1'</span>, [<span class="string">'test'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>] );</span><br><span class="line">pubsubz.publish( <span class="string">'example1'</span>, [&#123;<span class="string">'color'</span>:<span class="string">'blue'</span>&#125;,&#123;<span class="string">'text'</span>:<span class="string">'hello'</span>&#125;] );</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    pubsubz.unsubscribe( testSubscription );</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">pubsubz.publish( <span class="string">'example1'</span>, <span class="string">'hello again!'</span> );</span><br></pre></td></tr></table></figure>
<p>从源码可以看出，内部主要实现了 发布，订阅，退订 这三个方法。观察者的使用场合就是：当一个对象的改变需要同时改变其它对象，并且它不知道具体有多少对象需要改变的时候，就应该考虑使用观察者模式。有关该模式的更多介绍可以阅读 <a href="http://www.cnblogs.com/TomXu/archive/2012/03/02/2355128.html" target="_blank" rel="noopener">深入理解JavaScript系列（32）：设计模式之观察者模式</a></p>
<h5 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h5><p>Promise 对象是 CommonJS 工作组提出的一种规范，目的是为异步操作提供统一接口。在 ECMAScript 6 之前 JavaScript 语言原生是不支持 Promise 对象的。</p>
<p>首先，它是一个对象，也就是说与其他 JavaScript 对象的用法，没有什么两样；其次，它起到代理作用，充当异步操作与回调函数之间的中介。它使得异步操作具备同步操作的接口，使得程序具备正常的同步运行的流程，回调函数不必再一层层嵌套。</p>
<p>有关更多异步处理可以参阅读下面给出的文章<br><a href="http://javascript.ruanyifeng.com/advanced/promise.html" target="_blank" rel="noopener">阮一峰 - Promise</a><br><a href="http://www.oschina.net/translate/event-based-programming-what-async-has-over-sync" target="_blank" rel="noopener">基于事件的 JavaScript 编程：异步与同步</a><br><a href="http://javascript.ruanyifeng.com/jquery/deferred.html" target="_blank" rel="noopener">jQuery.Deferred对象</a></p>
<h4 id="JavaScript和有限状态机"><a href="#JavaScript和有限状态机" class="headerlink" title="JavaScript和有限状态机"></a>JavaScript和有限状态机</h4><p>有限状态机（Finite-state machine）是一个非常有用的模型，简单说，它有三个特征：</p>
<ul>
<li>状态总数（state）是有限的</li>
<li>任一时刻，只处在一种状态之中</li>
<li>某种条件下，会从一种状态转变（transition）到另一种状态</li>
</ul>
<p>有关该模式的实现，可以查看 <a href="https://github.com/jakesgordon/javascript-state-machine" target="_blank" rel="noopener">javascript-state-machine</a> ，在某些业务场景下应用，能更好的组织代码。</p>
<p>相关阅读：<br><a href="http://javascript.ruanyifeng.com/advanced/fsm.html" target="_blank" rel="noopener">阮一峰 - JavaScript与有限状态机</a><br><a href="http://www.cnblogs.com/TomXu/archive/2012/04/18/2437099.html" target="_blank" rel="noopener">深入理解JavaScript系列（43）：设计模式之状态模式</a></p>
<h4 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a>Web Worker</h4><p><a href="http://javascript.ruanyifeng.com/htmlapi/webworker.html" target="_blank" rel="noopener">http://javascript.ruanyifeng.com/htmlapi/webworker.html</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers</a><br><a href="http://www.alloyteam.com/2015/11/deep-in-web-worker/" target="_blank" rel="noopener">http://www.alloyteam.com/2015/11/deep-in-web-worker/</a><br><a href="http://www.ibm.com/developerworks/cn/web/1112_sunch_webworker/index.html" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/web/1112_sunch_webworker/index.html</a></p>
<h4 id="值传递-OR-引用传递"><a href="#值传递-OR-引用传递" class="headerlink" title="值传递 OR 引用传递"></a>值传递 OR 引用传递</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeStuff</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  a = a * <span class="number">10</span>;</span><br><span class="line">  b.item = <span class="string">"changed"</span>;</span><br><span class="line">  c = &#123;<span class="attr">item</span>: <span class="string">"changed"</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">item</span>: <span class="string">"unchanged"</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;<span class="attr">item</span>: <span class="string">"unchanged"</span>&#125;;</span><br><span class="line"></span><br><span class="line">changeStuff(num, obj1, obj2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.item);    </span><br><span class="line"><span class="built_in">console</span>.log(obj2.item);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>If it was pure pass by value, then changing <code>obj1.item</code> would have no effect on the <code>obj1</code> outside of the function. If it was pure pass by reference, then everything would have changed. <code>num</code> would be <code>100</code>, and <code>obj2.item</code> would read <code>changed</code>.</p>
</blockquote>
<blockquote>
<p>Instead, the situation is that the item passed in is passed by value. But the item that is passed by value is itself a reference. Technically, this is called <a href="https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_sharing" target="_blank" rel="noopener">call-by-sharing</a>.</p>
</blockquote>
<blockquote>
<p>In practical terms, this means that if you change the parameter itself (as with <code>num</code> and <code>obj2</code>), that won’t affect the item that was fed into the parameter. But if you change the INTERNALS of the parameter, that will propagate back up (as with <code>obj1</code>).</p>
</blockquote>
<p>详细可阅读<a href="http://stackoverflow.com/questions/518000/is-javascript-a-pass-by-reference-or-pass-by-value-language" target="_blank" rel="noopener">Is JavaScript a pass-by-reference or pass-by-value language?</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2016/Sass 之 Compass 用法指南/" itemprop="url">
                  Sass 之 Compass 用法指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-03T00:00:00+08:00" content="2016-11-03">
              2016-11-03
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是Compass"><a href="#什么是Compass" class="headerlink" title="什么是Compass"></a>什么是Compass</h3><p>简单的说 Compass 是 Sass 的工具库，有点像 Javascript 和 JQuery 的关系。学会了 Compass 能大大提升 CSS 的开放效率。若不清楚什么是 Sass ，可移步阅读 <a href="/blog/2016/SASS%20%E7%94%A8%E6%B3%95%E6%8C%87%E5%8D%97/">SASS 用法指南</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Compass 是用 Ruby 语言开发的，所以安装它之前，必须安装 Ruby 。在命名行下输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install compass</span><br></pre></td></tr></table></figure>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p>要创建一个你的 Compass 项目，假定它的名字叫做 testCompass，那么在命令行键入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compass create testCompass</span><br></pre></td></tr></table></figure>
<p>当前目录就会生成 testCompass 的子目录。进入到该目录，你会看到一个 <code>config.rb</code> 文件，这是你项目的配置文件。还有两个子目录 <code>sass</code> 和 <code>stylesheets</code> 前者存放 Sass 源文件，后者存放编译后的 css 文件。</p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>要在网站上使用，必须将 scss 后缀的文件编译成 css 文件。编译命令如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compass compile</span><br></pre></td></tr></table></figure>
<p>该命令在项目根目录下运行，会将 sass 子目录中的 scss 文件，编译成 css 文件，保存在 stylesheets 子目录中。</p>
<p>默认状态下，编译出来的 css 文件带有大量的注释。但在生产环境需要压缩后的 css 文件，这时要使用 <code>--output-style</code> 参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compass compile --output-style compressed</span><br></pre></td></tr></table></figure>
<p>Compass 只编译发生变动的文件，如果你要重新编译未变动的文件，需要使用 <code>--force</code> 参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compass compile --force</span><br></pre></td></tr></table></figure>
<p>除了使用命令行参数，还可以在配置文件 <code>config.rb</code> 中指定编译模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output_style = :expanded</span><br></pre></td></tr></table></figure>
<p><code>:expanded</code> 模式表示编译后保留原格式，其他值还包括 <code>:nested</code> <code>:compact</code> 和 <code>:compressed</code></p>
<p>也可以通过指定 environment 的值（ <code>:production</code> 或 <code>:development</code> ），智能判断编译模式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">environment = :development</span><br><span class="line"></span><br><span class="line">output_style = (environment == :production) ? :compressed : :expanded</span><br></pre></td></tr></table></figure>
<p>在命令行模式下，除了一次性编译命令，compass 还有自动编译命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ compass watch</span><br></pre></td></tr></table></figure>
<p>运行该命令后，只要 scss 文件发生变化，就会被自动编译成 css 文件。按 <code>Ctrl + C</code> 退出监听。</p>
<p>有官更多 compass 的用法，请到<a href="http://compass-style.org/" target="_blank" rel="noopener">官网</a>查阅</p>
<p>注意：在 sass 目录下 若文件以 <code>_</code> 开头，如 _mixin.scss, _variables.scss, _icons.scss 则编译时不会生成 css 文件到 stylesheets 目录。这特性可结合 <code>@import</code> 使用。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>Compass 采用模块结构，不同模块提供不同的功能。如 reset, css3, layout, typography, utilities 这些模块。具体怎么用，可参考<a href="http://compass-style.org/reference/compass/" target="_blank" rel="noopener">官方文档</a></p>
<p>下面给出一个示例代码，简单展示下 Compass 的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">//引入 compass 也可指定引入某模块如  @import &quot;compass/reset&quot;;</span><br><span class="line">@import &quot;compass&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// normalize 是第三方模块 使用前需要安装好，并在 config.rb 文件中 添加 require &quot;compass-normalize&quot;</span><br><span class="line">//@import &quot;normalize&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//浏览器的支持情况</span><br><span class="line">//@debug browsers();</span><br><span class="line">//@debug browser-versions(ie);</span><br><span class="line">//$supported-browsers : chrome;</span><br><span class="line">//$browser-minimum-versions:(&quot;ie&quot;:&quot;8&quot;);</span><br><span class="line">//@debug omitted-usage(&apos;ie&apos;, &apos;6&apos;);  //0.0093 使用率</span><br><span class="line"></span><br><span class="line">@include establish-baseline();</span><br><span class="line"></span><br><span class="line">body&#123;</span><br><span class="line">  @include debug-vertical-alignment;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//自动添加浏览器的前缀</span><br><span class="line">.radius&#123;</span><br><span class="line">    @include border-radius(4px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.transparent&#123;</span><br><span class="line">    @include opacity(0.5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.inline-block&#123;</span><br><span class="line">    @include inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a&#123;</span><br><span class="line">  @include link-colors(#000, #0cc, #0ca, #c0a, #fa0);</span><br><span class="line">  @include unstyled-link();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//强行换行</span><br><span class="line">.force-wrap&#123;</span><br><span class="line">  @include force-wrap();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nowrap&#123;</span><br><span class="line">  @include nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//不换行 长度超出变成 ...</span><br><span class="line">.ellipsis&#123;</span><br><span class="line">  @include ellipsis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//若只兼容 ie8 以上 则编译后的 css 不出现 display: inline; （双边距）</span><br><span class="line">.left&#123;</span><br><span class="line">  @include float(&apos;left&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article&#123;</span><br><span class="line">  h1,h2,h3,p&#123;</span><br><span class="line">    margin:0;</span><br><span class="line">  &#125;</span><br><span class="line">  h1&#123;</span><br><span class="line">    //font-size:3em;  //48 / 16 = 3</span><br><span class="line">    //line-height: 1.5em; // 72 / 48 = 1.5</span><br><span class="line">    @include adjust-font-size-to(48px);</span><br><span class="line">  &#125;</span><br><span class="line">  h2&#123;</span><br><span class="line">    //font-size:2.25em;  //36 / 16 = 2.25</span><br><span class="line">    //line-height: 1.333333em;  // 48 / 36 = 1.333333</span><br><span class="line">    @include adjust-font-size-to(36px);</span><br><span class="line">  &#125;</span><br><span class="line">  h3&#123;</span><br><span class="line">    //font-size:1.5em;  //24 / 16 = 1.5</span><br><span class="line">    //line-height: 2em;  // 48 / 24 = 2</span><br><span class="line">    @include adjust-font-size-to(24px);</span><br><span class="line">  &#125;</span><br><span class="line">  p&#123;</span><br><span class="line">    // font-size:1em;</span><br><span class="line">    // line-height: 1.5em;</span><br><span class="line">    @include adjust-font-size-to(16px);</span><br><span class="line">    @include leader();</span><br><span class="line">    @include trailer();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//base64</span><br><span class="line">.img1&#123;</span><br><span class="line">    background-image: inline-image(&quot;2.jpeg&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.img2&#123;</span><br><span class="line">    background-image: image-url(&quot;0.jpg&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tableStyle&#123;</span><br><span class="line"></span><br><span class="line">   //外边框</span><br><span class="line">   @include outer-table-borders(2px, #f60);</span><br><span class="line"></span><br><span class="line">   //单元格边框</span><br><span class="line">   @include inner-table-borders(1px, #000);</span><br><span class="line"></span><br><span class="line">   //格式化</span><br><span class="line">   @include table-scaffolding;</span><br><span class="line"></span><br><span class="line">   @include alternating-rows-and-columns(#fff, #f90, #222);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//清楚浮动</span><br><span class="line">.clearfix&#123;</span><br><span class="line">  @include legacy-pie-clearfix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.minH&#123;</span><br><span class="line">  @include min-height(30px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//精灵图</span><br><span class="line">@import &apos;icons&apos;;</span><br></pre></td></tr></table></figure>
<p>其中 <code>_icons.scss</code> 的代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//为 true 则样式中加上图片宽高</span><br><span class="line">$icons-sprite-dimensions : true;</span><br><span class="line"></span><br><span class="line">//合成布局 水平(horizontal) 垂直 对角线(diagon) 最节省空格 smart</span><br><span class="line">$icons-layout : horizontal;</span><br><span class="line"></span><br><span class="line">//间隔</span><br><span class="line">$icons-spacing : 30px;</span><br><span class="line"></span><br><span class="line">//更多参数参考 http://compass-style.org/help/tutorials/spriting/customization-options/</span><br><span class="line"></span><br><span class="line">@import &quot;icons/*.png&quot;;</span><br><span class="line"></span><br><span class="line">@include all-icons-sprites();</span><br><span class="line"></span><br><span class="line">//这样使类名 main-logo 有 s03 的样式</span><br><span class="line">.main-logo&#123;</span><br><span class="line">    @include icons-sprite(&apos;s03&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//也可以生成带伪类的样式 图片命名 如 a.png 和 a_hover.png</span><br></pre></td></tr></table></figure>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>通过 sass 和 less 等这种 css 预处理器，可以让我们更高效多书写样式。另外要提一下的就是 <a href="https://github.com/postcss/postcss" target="_blank" rel="noopener">postcss</a> 相关介绍和教程可跳阅读 <a href="http://www.w3cplus.com/blog/tags/516.html" target="_blank" rel="noopener">http://www.w3cplus.com/blog/tags/516.html</a></p>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a href="http://www.ruanyifeng.com/blog/2012/11/compass.html" target="_blank" rel="noopener">阮一峰 - Compass 用法指南</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2016/SASS 用法指南/" itemprop="url">
                  SASS 用法指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-02T00:00:00+08:00" content="2016-11-02">
              2016-11-02
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是-SASS"><a href="#什么是-SASS" class="headerlink" title="什么是 SASS"></a>什么是 SASS</h3><p>SASS 是一种 CSS 开发工具，提供了许多便利的写法，使得 CSS 编写变得简单和可维护。本文总结了 SASS 的常用用法，高手可略过，也可参考<a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html" target="_blank" rel="noopener">官方文档</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>使用 SASS 需要安装 Ruby ，Windows 用户可在这 <a href="http://rubyinstaller.org/downloads/" target="_blank" rel="noopener">下载</a> Ruby 的安装包。假定你已经安装好了 Ruby ，接着在命令行输入下面的命令进行安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gem install sass</span><br></pre></td></tr></table></figure>
<p>可以通过 <code>sass -v</code> 来检测 SASS 是否安装成功。</p>
<p>由于国内网络原因，导致 rubygems.org 存放在 Amazon S3 上面的资源文件间歇性连接失败。这时我们可以利用淘宝提供的 <a href="https://ruby.taobao.org/" target="_blank" rel="noopener">RubyGems 镜像</a> ，在命令行输入下面命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/</span><br><span class="line">$ gem sources -l</span><br><span class="line">*** CURRENT SOURCES ***</span><br><span class="line"></span><br><span class="line">https://ruby.taobao.org</span><br></pre></td></tr></table></figure>
<p>若切换淘宝提供的镜像是提示 <code>SSL</code> <code>certificate verify failed</code> 相关的信息，那需要进一步的设置。下面是简单描述:</p>
<ol>
<li>到 <code>https://curl.haxx.se/ca/cacert.pem</code> 下载证书，一般放到 Ruby 安装的根目录即可。</li>
<li>设置环境变量，变量名为 <code>SSL_CERT_FILE</code> 值为证书地址。如：<code>D:\Program Files\Ruby23-x64\cacert.pem</code></li>
<li>重启客户端，再重新设置</li>
<li>可参考 <a href="https://gist.github.com/fnichol/867550" target="_blank" rel="noopener">https://gist.github.com/fnichol/867550</a> 和 <a href="http://www.csdn123.com/html/topnews201408/35/3635.htm" target="_blank" rel="noopener">http://www.csdn123.com/html/topnews201408/35/3635.htm</a></li>
</ol>
<p>另外提醒一下 <code>npm</code> 也存在同样的情况，也可换成 <a href="http://npm.taobao.org/" target="_blank" rel="noopener">淘宝 NPM 镜像</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm config set registry https://registry.npm.taobao.org</span><br><span class="line">$ npm config get registry</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>SASS 文件是普通的文本文件，文件后缀名是 <code>.scss</code> ，我们需要将其编译成 <code>*.css</code> 的文件来使用，命令如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sass test.scss test.css</span><br><span class="line">$ sass --style compressed test.sass test.css</span><br></pre></td></tr></table></figure>
<p>SASS 提供四个<a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html#output_style" target="_blank" rel="noopener">编译风格</a>的选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. nested：嵌套缩进的css代码，它是默认值。</span><br><span class="line"></span><br><span class="line">2. expanded：没有缩进的、扩展的css代码。</span><br><span class="line"></span><br><span class="line">3. compact：简洁格式的css代码。</span><br><span class="line"></span><br><span class="line">4. compressed：压缩后的css代码。</span><br></pre></td></tr></table></figure>
<p>你也可以让 SASS 监听某个文件或目录，一旦源文件有变动，就自动生成编译后的版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sass --watch input.scss:output.css  // watch a file</span><br><span class="line"></span><br><span class="line">$ sass --watch app/sass:public/stylesheets  // watch a directory</span><br></pre></td></tr></table></figure>
<p>按 <code>Ctrl + C</code> 可停止监听，另外还有一个<a href="http://www.sassmeister.com/" target="_blank" rel="noopener">在线转换器</a>，你可以在那里，试运行下面的例子。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><h4 id="1-注释"><a href="#1-注释" class="headerlink" title="1.注释"></a>1.注释</h4><p>SASS 共有两种注释风格</p>
<ul>
<li>标准的 CSS 注释 <code>/* comment */</code> ，会保留到编译后的文件。</li>
<li>单行注释 <code>// comment</code> ，只保留在 SASS 源文件中，编译后被省略。</li>
</ul>
<p>在 <code>/*</code> 后面加一个感叹号，表示这是”重要注释”。即使是压缩模式编译，也会保留这行注释，通常可以用于声明版权信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/*!</span><br><span class="line">  重要注释！</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="2-变量"><a href="#2-变量" class="headerlink" title="2.变量"></a>2.变量</h4><p>SASS 允许使用变量，所有变量以 <code>$</code> 开头。如果变量需要镶嵌在字符串之中，就必须需要写在 <code>#{}</code> 之中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$blue : #1875e7;</span><br><span class="line">$side : left;</span><br><span class="line"></span><br><span class="line">div &#123;</span><br><span class="line">  color : $blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.rounded &#123;</span><br><span class="line">  border-#&#123;$side&#125;-radius: 5px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-计算功能"><a href="#3-计算功能" class="headerlink" title="3.计算功能"></a>3.计算功能</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">　margin: (14px/2);</span><br><span class="line">　top: 50px + 100px;</span><br><span class="line">　right: 2 * 10%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-嵌套"><a href="#4-嵌套" class="headerlink" title="4.嵌套"></a>4.嵌套</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    h1 &#123;</span><br><span class="line">        color:red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>属性也可以嵌套</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p &#123;</span><br><span class="line">    border:&#123;</span><br><span class="line">        width:1px;</span><br><span class="line">        color:#f90;</span><br><span class="line">        style:solid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在嵌套的代码块内，可以使用 <code>&amp;</code> 引用父元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a &#123;</span><br><span class="line">  color:#000;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    color: green;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-继承"><a href="#5-继承" class="headerlink" title="5.继承"></a>5.继承</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.class1&#123;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height:100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.class2&#123;</span><br><span class="line">    @extend .class1;</span><br><span class="line">    background-color: #fa0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面示例编译后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.class1, .class2 &#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.class2 &#123;</span><br><span class="line">  background-color: #fa0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-Mixin"><a href="#6-Mixin" class="headerlink" title="6.Mixin"></a>6.Mixin</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@mixin rounded($vert, $horz, $radius:10px) &#123;</span><br><span class="line">　　　　border-#&#123;$vert&#125;-#&#123;$horz&#125;-radius: $radius;</span><br><span class="line">　　　　-moz-border-radius-#&#123;$vert&#125;#&#123;$horz&#125;: $radius;</span><br><span class="line">　　　　-webkit-border-#&#123;$vert&#125;-#&#123;$horz&#125;-radius: $radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">div &#123;</span><br><span class="line">  @include rounded(top, left, 5px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-插入文件"><a href="#7-插入文件" class="headerlink" title="7.插入文件"></a>7.插入文件</h4><p><code>@import</code> 命令，用来插入外部文件。如果插入的是 <code>.css</code> 文件，则等同于 css 的 import 命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &apos;*.scss&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="8-自定义函数"><a href="#8-自定义函数" class="headerlink" title="8.自定义函数"></a>8.自定义函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@function double($n)&#123;</span><br><span class="line">  @return $n * 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.testDouble&#123;</span><br><span class="line">  width:double(100px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>更多特性可自行查看 <a href="http://sass-lang.com/" target="_blank" rel="noopener">SASS 官网</a>，和 SASS 类似的有 LESS ，可百度了解。另外还有一个强悍的 SASS 工具库 Compass</p>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a href="http://www.ruanyifeng.com/blog/2012/06/sass.html" target="_blank" rel="noopener">阮一峰 - SASS用法指南</a></li>
<li><a href="http://www.w3cplus.com/sassguide/" target="_blank" rel="noopener">sass 入门</a></li>
<li><a href="http://www.sasschina.com/" target="_blank" rel="noopener">sass 中文网</a></li>
<li><a href="http://sass.bootcss.com/" target="_blank" rel="noopener">sass 中文文档</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2016/RequireJS 笔记/" itemprop="url">
                  RequireJS 笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-13T00:00:00+08:00" content="2016-10-13">
              2016-10-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>RequireJS 是一个工具库，能在网页中进行模块化编程，从而提高代码的性能和可维护性。它的模块管理遵守 <a href="https://github.com/amdjs/amdjs-api/wiki/AMD-%28%E4%B8%AD%E6%96%87%E7%89%88%29" target="_blank" rel="noopener">AMD 规范</a>。类似的库还有 sea.js 国人开发的一个库，遵守 CMD 规范。</p>
<p>个人推荐使用 RequireJS 库，从功能上说，两者是差不多的，但 RequireJS 有完善的文档和很好的打包工具可用，相比 sea.js 强多了，在这里吐槽下，感觉之前被 sea.js 坑了不少。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="加载-javascript-文件"><a href="#加载-javascript-文件" class="headerlink" title="加载 javascript 文件"></a>加载 javascript 文件</h4><p>RequireJS 以一个相对于 <code>baseUrl</code> 的地址来加载所有的代码。 页面顶层 <code>&lt;script&gt;</code> 标签含有一个特殊的属性 <code>data-main</code> 使用它来启动脚本加载过程，而 <code>baseUrl</code> 一般设置到与该属性相一致的目录。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script data-main=<span class="string">"scripts/main.js"</span> src=<span class="string">"scripts/require.js"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><code>baseUrl</code> 亦可通过 RequireJS config 手动设置。如果没有显式指定 config 及 data-main ，则默认的 baseUrl 为包含 RequireJS 的那个 HTML 页面的所属目录。</p>
<p>若符合下述规则之一，则可避开 <code>baseUrl + paths</code> 配置</p>
<ul>
<li>以 “.js” 结束</li>
<li>以 “/“ 开始</li>
<li>包含 URL 协议, 如 “http:” or “https:”</li>
</ul>
<p>一般来说，最好还是使用 <code>baseUrl</code> 及 <code>paths</code> 去设置。它会给你带来额外的灵活性，如便于脚本的重命名、重定位等。同时，为了避免凌乱的配置，最好不要使用多级嵌套的目录层次来组织代码。</p>
<h4 id="模块的定义"><a href="#模块的定义" class="headerlink" title="模块的定义"></a>模块的定义</h4><p>1.Simple Name/Value Pairs</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(&#123;</span><br><span class="line">    color: <span class="string">"black"</span>,</span><br><span class="line">    size: <span class="string">"unisize"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2.Definition Functions</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        color: <span class="string">"black"</span>,</span><br><span class="line">        size: <span class="string">"unisize"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3.Definition Functions with Dependencies</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">"./cart"</span>, <span class="string">"./inventory"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">cart, inventory</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//return an object</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            color: <span class="string">"blue"</span>,</span><br><span class="line">            size: <span class="string">"large"</span>,</span><br><span class="line">            addToCart: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                inventory.decrement(<span class="keyword">this</span>);</span><br><span class="line">                cart.add(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>依赖关系会以参数的形式注入到函数上，参数列表与依赖名称列表一一对应。</p>
<p>4.Define a Module as a Function</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">"my/cart"</span>, <span class="string">"my/inventory"</span>],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">cart, inventory</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//return a function.</span></span><br><span class="line">        <span class="comment">//It gets or sets the window title.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">title</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> title ? (<span class="built_in">window</span>.title = title) :</span><br><span class="line">                   inventory.storeName + <span class="string">' '</span> + cart.name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>5.Define a Module with Simplified CommonJS Wrapper</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'a'</span>),</span><br><span class="line">            b = <span class="built_in">require</span>(<span class="string">'b'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Return the module value</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>利用 <code>Function.prototype.toString()</code> 实现，但在一些设备如 PS3 及一些老的 Opera 手机浏览器中不起作用。</p>
<p>6.Define a Module with a Name</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="string">"foo/title"</span>,</span><br><span class="line">    [<span class="string">"my/cart"</span>, <span class="string">"my/inventory"</span>],</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">cart, inventory</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">   &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>可看到一些 define() 中包含了一个模块名称作为首个参数，这些常由打包工具生成。你也可以自己显式指定模块名称，但这使模块更不具备移植性——就是说若你将文件移动到其他目录下，你就得重命名。</p>
<h3 id="Loader-Plugins"><a href="#Loader-Plugins" class="headerlink" title="Loader Plugins"></a>Loader Plugins</h3><p>有关 Loader Plugins 可跳转阅读 <a href="http://requirejs.org/docs/api.html#plugins" target="_blank" rel="noopener">http://requirejs.org/docs/api.html#plugins</a> 有关 requirejs 插件的编写可跳阅 <a href="http://requirejs.org/docs/plugins.html#api" target="_blank" rel="noopener">http://requirejs.org/docs/plugins.html#api</a></p>
<h3 id="CommonJS-Compatibility"><a href="#CommonJS-Compatibility" class="headerlink" title="CommonJS Compatibility"></a>CommonJS Compatibility</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BAD</span></span><br><span class="line"><span class="keyword">var</span> mod = <span class="built_in">require</span>(someCondition ? <span class="string">'a'</span> : <span class="string">'b'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//BAD</span></span><br><span class="line"><span class="keyword">if</span> (someCondition) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'a'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">'b'</span>);</span><br></pre></td></tr></table></figure>
<p>以上的写法在 RequireJS 中是错误的用法，这样做的话, a 和 b 这两模块都会加载到页面中，这里可查看下文给出的列子。详细可点击阅读 <a href="http://requirejs.org/docs/whyamd.html#commonjscompat" target="_blank" rel="noopener">CommonJS Compatibility</a><br>这种业务场景的解决方案 <a href="https://github.com/amdjs/amdjs-api/wiki/require" target="_blank" rel="noopener">callback-require</a></p>
<h3 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h3><p>RequireJS 使用 head.appendChild() 将每一个依赖加载为一个 script 标签。<br>RequireJS 等待所有的依赖加载完毕，加载是异步的，计算出模块定义函数正确调用顺序，然后依次调用它们。</p>
<h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><p>RequireJS 提供一个基于 node.js 的命令行工具 r.js ，用来压缩多个 js 文件。它的主要作用是将多个模块文件压缩合并成一个脚本文件，以减少网页的HTTP请求数。例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node r.js -o baseUrl=. name=main out=main-built.js</span><br></pre></td></tr></table></figure>
<p>除了直接在命令行提供参数设置，也可以将参数写入一个文件，假定文件名为 build.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node r.js -o build.js</span><br></pre></td></tr></table></figure>
<p>有关更多的配置项可查看 <a href="https://github.com/requirejs/r.js/blob/master/build/example.build.js" target="_blank" rel="noopener">example.build.js</a> 和一个打包示例 <a href="https://github.com/requirejs/example-multipage" target="_blank" rel="noopener">requirejs/example-multipage</a></p>
<p>进一步优化，使用 r.js 优化后的代码可以使用 <a href="https://github.com/requirejs/almond" target="_blank" rel="noopener">almond</a> 来加载。</p>
<h3 id="RequireJS-用法示例"><a href="#RequireJS-用法示例" class="headerlink" title="RequireJS 用法示例"></a>RequireJS 用法示例</h3><p>例子中有对上文内容的一些补充，建议详细阅读代码。大家可点击 <a href="https://github.com/avilang/experience/tree/master/learn-requirejs" target="_blank" rel="noopener">例子</a> 打开看看，留意控制台的输出，注意这里为了演示就没有对 js 进行打包。</p>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a href="http://requirejs.org/" target="_blank" rel="noopener">requirejs 官网</a></li>
<li><a href="http://www.requirejs.cn/" target="_blank" rel="noopener">requirejs 中文官网</a></li>
<li><a href="http://javascript.ruanyifeng.com/tool/requirejs.html" target="_blank" rel="noopener">RequireJS 和 AMD 规范</a></li>
<li><a href="http://leeluolee.github.io/2014/10/19/write-requirejs-plugin/" target="_blank" rel="noopener">requirejs的插件介绍与制作</a></li>
<li><a href="http://www.cnblogs.com/lhb25/p/requirejs-ptimizer-using.html" target="_blank" rel="noopener">RequireJS Optimizer 的使用和配置方法</a></li>
<li><a href="https://www.douban.com/note/283566440/" target="_blank" rel="noopener">SeaJS 与 RequireJS 最大的区别</a></li>
<li><a href="https://imququ.com/post/amd-simplified-commonjs-wrapping.html" target="_blank" rel="noopener">AMD 的 CommonJS wrapping</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2016/javascript 正则表达式/" itemprop="url">
                  javascript 正则表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-08T00:00:00+08:00" content="2016-10-08">
              2016-10-08
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>之前已写<a href="/blog/2016/PHP%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AC%94%E8%AE%B0/">《PHP 正则表达式笔记》</a>一文介绍正则表达式，本篇仅是作知识点的补充，文章逻辑编排版较随意。</p>
<h3 id="创建一个正则表达式"><a href="#创建一个正则表达式" class="headerlink" title="创建一个正则表达式"></a>创建一个正则表达式</h3><p>你可以通过下面两种方法创建一个正则表达式:</p>
<p>1、使用一个正则表达式字面量，如下所示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/ab+c/</span>;</span><br></pre></td></tr></table></figure>
<p>2、调用 RegExp 对象的构造函数，如下所示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"ab+c"</span>);</span><br></pre></td></tr></table></figure>
<p>正则表达式字面量在脚本加载后编译,使用构造函数，提供了对正则表达式运行时的编译。同一个正则表达式可能会被编译多次，所以可将其保存在一个变量中以供后使用。<br>当你知道正则表达式的模式会发生改变，或者你事先并不了解它的模式或者是从其他地方（比如用户的输入），得到的代码这时比较适合用构造函数的方式。</p>
<p>有时候需要对正则字符串进行转义处理，下面给出一示例:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escapeRegExp</span>(<span class="params">string</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//$&amp;表示被匹配的字符串</span></span><br><span class="line">  <span class="keyword">return</span> string.replace(<span class="regexp">/([.*+?^=!:$&#123;&#125;()|[\]\/\\])/g</span>, <span class="string">"\\$&amp;"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>摘自犀牛书：在 ECMAScript 3 规范中，用正则表达式创建的 RegExp 对象会共享一个实例，而在 ECMAScript 5中则是两个独立实例。</p>
<h3 id="正则对象的属性和方法"><a href="#正则对象的属性和方法" class="headerlink" title="正则对象的属性和方法"></a>正则对象的属性和方法</h3><p>javascript 语言里某种程度上可以认为 “一切皆对象”，那么 RegExp 对象也有其属性和方法。如 <code>ignoreCase</code> <code>global</code> <code>lastIndex</code> <code>match()</code> <code>exec()</code> 等属性和方法。</p>
<p>另外字符串的正则方法，如 <code>replace</code> <code>search</code> <code>split</code> <code>match</code> 方法，ES6 将这4个方法，语言内部全部调用 RegExp 的实例方法，从而做到所有与正则相关的方法，全都定义在 RegExp 对象上。</p>
<p>在这不具体介绍 javascript 正则对象的属性和方法的详细用法，读者可自行查阅。</p>
<h3 id="u-修饰符"><a href="#u-修饰符" class="headerlink" title="u 修饰符"></a>u 修饰符</h3><p>ES6 对正则表达式添加了 <code>u</code> 修饰符，含义为“Unicode模式”，用来正确处理大于 <code>\uFFFF</code> 的 Unicode 字符。也就是说，会正确处理四个字节的 UTF-16 编码。</p>
<p>可点击查阅 <a href="http://javascript.ruanyifeng.com/grammar/string.html#toc5" target="_blank" rel="noopener">javascript 字符集</a> 了解更多 javascript 中字符的知识，学学如何处理四个字节的 UTF-16 编码。</p>
<h3 id="y-修饰符"><a href="#y-修饰符" class="headerlink" title="y 修饰符"></a>y 修饰符</h3><p>ES6 还为正则表达式添加了 <code>y</code> 修饰符，叫做“粘连”（sticky）修饰符。</p>
<p><code>y</code> 修饰符的一个应用，是从字符串提取 token（词元），<code>y</code> 修饰符确保了匹配之间不会有漏掉的字符。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TOKEN_Y = <span class="regexp">/\s*(\+|[0-9]+)\s*/y</span>;</span><br><span class="line"><span class="keyword">const</span> TOKEN_G  = <span class="regexp">/\s*(\+|[0-9]+)\s*/g</span>;</span><br><span class="line"></span><br><span class="line">tokenize(TOKEN_Y, <span class="string">'3 + 4'</span>)</span><br><span class="line"><span class="comment">// [ '3', '+', '4' ]</span></span><br><span class="line">tokenize(TOKEN_G, <span class="string">'3 + 4'</span>)</span><br><span class="line"><span class="comment">// [ '3', '+', '4' ]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenize</span>(<span class="params">TOKEN_REGEX, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">let</span> match;</span><br><span class="line">  <span class="keyword">while</span> (match = TOKEN_REGEX.exec(str)) &#123;</span><br><span class="line">    result.push(match[<span class="number">1</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，如果字符串里面没有非法字符，y修饰符与g修饰符的提取结果是一样的。但是，一旦出现非法字符，两者的行为就不一样了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tokenize(TOKEN_Y, <span class="string">'3x + 4'</span>)</span><br><span class="line"><span class="comment">// [ '3' ]</span></span><br><span class="line">tokenize(TOKEN_G, <span class="string">'3x + 4'</span>)</span><br><span class="line"><span class="comment">// [ '3', '+', '4' ]</span></span><br></pre></td></tr></table></figure>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>以下给出简单列子，说明了一些正值表达式的用途。本文中许多有关 javascript 正则中的知识点并未介绍到，如断言、组匹配、反向引用等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = <span class="string">"Harry Trump ;Fred Barney; Helen Rigby ; Bill Abel ; Chris Hand "</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> output = [<span class="string">"---------- Original String\n"</span>, names + <span class="string">"\n"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pattern = <span class="regexp">/\s*;\s*/</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nameList = names.split(pattern);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pattern = <span class="regexp">/(\w+)\s+(\w+)/</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bySurnameList = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output.push(<span class="string">"---------- After Split by Regular Expression"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i, len;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, len = nameList.length; i &lt; len; i++)&#123;</span><br><span class="line">  output.push(nameList[i]);</span><br><span class="line">  bySurnameList[i] = nameList[i].replace(pattern, <span class="string">"$2, $1"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output.push(<span class="string">"---------- Names Reversed"</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, len = bySurnameList.length; i &lt; len; i++)&#123;</span><br><span class="line">  output.push(bySurnameList[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bySurnameList.sort();</span><br><span class="line">output.push(<span class="string">"---------- Sorted"</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, len = bySurnameList.length; i &lt; len; i++)&#123;</span><br><span class="line">  output.push(bySurnameList[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output.push(<span class="string">"---------- End"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(output.join(<span class="string">"\n"</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问：请找出所有在 3 个连续相同字符前的相邻 3 个连续相同字符</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="string">'aaalllsss0tAAAnnn999'</span>;</span><br><span class="line"><span class="keyword">var</span> re = <span class="regexp">/(\w)\1&#123;2&#125;(?=(\w)\2&#123;2&#125;)/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(s.match(re));  <span class="comment">// [ 'aaa', 'lll', 'AAA', 'nnn' ]</span></span><br></pre></td></tr></table></figure>
<h3 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h3><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener">javascript - 中的正则表达式</a></li>
<li><a href="http://es6.ruanyifeng.com/#docs/regex" target="_blank" rel="noopener">阮一峰 - 正则的扩展</a></li>
<li><a href="http://javascript.ruanyifeng.com/grammar/string.html" target="_blank" rel="noopener">阮一峰 - 字符串</a></li>
<li><a href="http://fxck.it/post/50558232873" target="_blank" rel="noopener">正则表达式之：零宽断言</a></li>
<li><a href="https://segmentfault.com/a/1190000008088937" target="_blank" rel="noopener">JS正则表达式一条龙讲解</a></li>
<li><a href="http://louiszhai.github.io/2016/06/13/regexp/" target="_blank" rel="noopener">正则表达式前端使用手册</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars3.githubusercontent.com/u/10380760?v=3&s=466"
               alt="avilang" />
          <p class="site-author-name" itemprop="name">avilang</p>
          <p class="site-description motion-element" itemprop="description">爱折腾，爱分享，爱学习</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/blog/archives">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/avilang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">avilang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
